---
phase: 09-skills-plugins-workflows
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/entities/plugin/model/types.ts
  - src/entities/plugin/model/schemas.ts
  - src/entities/plugin/index.ts
  - src/features/plugins/api/use-plugins.ts
  - src/features/plugins/api/use-plugin-detail.ts
  - src/features/plugins/api/use-plugin-install.ts
  - src/features/plugins/components/plugin-table.tsx
  - src/features/plugins/components/plugin-browser.tsx
  - src/features/plugins/components/plugin-detail-panel.tsx
  - src/features/plugins/components/plugin-settings-form.tsx
  - src/features/plugins/components/plugin-agent-toggles.tsx
  - src/features/plugins/model/plugin-install-store.ts
  - src/views/plugins/plugins-list-view.tsx
  - src/views/plugins/plugin-install-view.tsx
  - src/views/plugins/plugin-detail-view.tsx
  - app/(dashboard)/plugins/page.tsx
  - app/(dashboard)/plugins/install/page.tsx
  - app/(dashboard)/plugins/[pluginId]/page.tsx
  - src/shared/lib/query-keys.ts
autonomous: true
requirements:
  - SKIL-04
  - SKIL-05

must_haves:
  truths:
    - "User can view installed plugins in a DataTable at /plugins with name, version, status, last updated, and action menu"
    - "User can browse available plugins at /plugins/install with search and one-click install"
    - "User can view plugin details with readme, settings form, agent toggles, and update history at /plugins/[pluginId]"
    - "User can enable/disable plugins per agent via toggle switches"
  artifacts:
    - path: "src/entities/plugin/model/types.ts"
      provides: "Plugin, PluginConfig, AvailablePlugin, PluginDetail types"
      min_lines: 40
    - path: "src/features/plugins/components/plugin-table.tsx"
      provides: "DataTable with columns for installed plugins"
      min_lines: 40
    - path: "src/features/plugins/components/plugin-browser.tsx"
      provides: "Visual browser with plugin cards, search, install buttons"
      min_lines: 60
    - path: "src/views/plugins/plugin-detail-view.tsx"
      provides: "Full plugin detail page with settings, agent toggles, readme"
      min_lines: 60
  key_links:
    - from: "src/views/plugins/plugins-list-view.tsx"
      to: "src/features/plugins/components/plugin-table.tsx"
      via: "imports and renders PluginTable"
      pattern: "import.*PluginTable"
    - from: "src/features/plugins/components/plugin-browser.tsx"
      to: "src/features/plugins/api/use-plugin-install.ts"
      via: "install mutation on button click"
      pattern: "useInstallPlugin"
    - from: "app/(dashboard)/plugins/[pluginId]/page.tsx"
      to: "src/views/plugins/plugin-detail-view.tsx"
      via: "route page renders view"
      pattern: "PluginDetailView"
---

<objective>
Build the complete plugin management system: installed plugins DataTable at /plugins, visual plugin browser with install flow at /plugins/install, and full plugin detail page at /plugins/[pluginId].

Purpose: Users need to manage workspace-wide plugins, install new ones, and configure per-agent plugin access.
Output: 3 fully functional plugin pages with entity types, mock data, install progress tracking, and TanStack Query hooks.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-skills-plugins-workflows/09-RESEARCH.md

Key patterns to follow:
- DataTable: src/shared/ui/data-table.tsx (generic DataTable with columns/data)
- Action menu: src/shared/ui/action-menu.tsx (dropdown with icon items)
- Plugin list reference: src/features/gateway/components/section-forms/plugins-section.tsx (badge-based list in gateway config)
- Agent toggles: Phase 3 agent skills (optimistic mutation pattern)
- Markdown preview: dynamic import @uiw/react-md-editor with ssr: false
- Query keys: src/shared/lib/query-keys.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Plugin entity types, query keys, TanStack Query hooks, and install progress store</name>
  <files>
    src/entities/plugin/model/types.ts
    src/entities/plugin/model/schemas.ts
    src/entities/plugin/index.ts
    src/features/plugins/api/use-plugins.ts
    src/features/plugins/api/use-plugin-detail.ts
    src/features/plugins/api/use-plugin-install.ts
    src/features/plugins/model/plugin-install-store.ts
    src/shared/lib/query-keys.ts
  </files>
  <action>
    Create the plugin entity layer and data hooks:

    **types.ts**: Define types:
    - `PluginStatus`: "active" | "disabled" | "error"
    - `Plugin`: id, name, version, description, status (PluginStatus), lastUpdated (Date), author, homepage (string | null), permissions (string[]), agentCount (number)
    - `AvailablePlugin`: id, name, version, description, author, downloads, category (string), installed (boolean), icon (string - lucide icon name)
    - `PluginDetail`: extends Plugin with readme (string - markdown), config (Record<string, unknown> | null), configSchema (Record<string, unknown> | null), agents (array of { id, name, enabled }), updateHistory (array of { version, date, changelog })
    - `PluginInstallProgress`: pluginId, name, status ("downloading" | "installing" | "configuring" | "complete" | "error"), progress (0-100), error (string | null)

    **schemas.ts**: Zod v4 schemas for Plugin and AvailablePlugin using z.object() with appropriate field types.

    **index.ts**: Barrel export all types and schemas.

    **query-keys.ts**: Add `plugins` domain to existing queryKeys (be careful not to conflict with Plan 01's additions -- if Plan 01 runs concurrently, handle the merge):
    ```
    plugins: {
      all: ["plugins"],
      lists: () => [...queryKeys.plugins.all, "list"],
      list: (filters?) => [...queryKeys.plugins.lists(), filters],
      details: () => [...queryKeys.plugins.all, "detail"],
      detail: (id: string) => [...queryKeys.plugins.details(), id],
      available: () => [...queryKeys.plugins.all, "available"],
    },
    ```

    **use-plugins.ts**: `usePlugins()` hook with 6-8 mock installed plugins (mix of active/disabled/error statuses). Include `useTogglePlugin(pluginId)` and `useUninstallPlugin()` mutations with optimistic cache updates.

    **use-plugin-detail.ts**: `usePluginDetail(pluginId)` returning a single PluginDetail with mock readme markdown (100+ chars), config object, agent list (3-4 agents with mixed enabled/disabled), and 3-4 update history entries. Include `useUpdatePluginConfig` and `useTogglePluginForAgent` mutations.

    **use-plugin-install.ts**: `useAvailablePlugins(search?)` returning 12-15 mock available plugins. `useInstallPlugin()` mutation that updates the install store with progress states (uses setTimeout to simulate download -> install -> configure -> complete over 2-3 seconds).

    **plugin-install-store.ts**: Zustand store for tracking install progress:
    - State: installs (Map<string, PluginInstallProgress>)
    - Actions: startInstall(pluginId, name), updateProgress(pluginId, status, progress), completeInstall(pluginId), failInstall(pluginId, error), clearInstall(pluginId)
    - No persistence needed (ephemeral install session state)
  </action>
  <verify>Run `npx tsc --noEmit` -- no type errors. Verify query-keys.ts compiles with the new plugins domain.</verify>
  <done>Plugin entity types exported, query keys extended with plugins domain, 3 TanStack Query hooks return realistic mock data, and Zustand install store tracks progress.</done>
</task>

<task type="auto">
  <name>Task 2: Plugin table, browser, detail page with views and routes</name>
  <files>
    src/features/plugins/components/plugin-table.tsx
    src/features/plugins/components/plugin-browser.tsx
    src/features/plugins/components/plugin-detail-panel.tsx
    src/features/plugins/components/plugin-settings-form.tsx
    src/features/plugins/components/plugin-agent-toggles.tsx
    src/views/plugins/plugins-list-view.tsx
    src/views/plugins/plugin-install-view.tsx
    src/views/plugins/plugin-detail-view.tsx
    app/(dashboard)/plugins/page.tsx
    app/(dashboard)/plugins/install/page.tsx
    app/(dashboard)/plugins/[pluginId]/page.tsx
  </files>
  <action>
    Build all plugin UI components and pages:

    **plugin-table.tsx**: DataTable (reuse shared DataTable component) with columns:
    - Name (bold, with small description subtitle)
    - Version (mono font)
    - Status (StatusBadge: active=success, disabled=warning, error=error)
    - Last Updated (relative time via date-fns formatDistanceToNow)
    - Actions (ActionMenu: Configure -> navigates to /plugins/[id], Disable/Enable toggle, Uninstall with destructive variant)
    Row click navigates to /plugins/[id]. Accept `plugins` data and `isLoading` props.

    **plugin-browser.tsx**: Visual GUI browser per user decision:
    - Top: SearchInput with nuqs URL state for search query
    - Below: category chip filters (All, Analytics, Messaging, Storage, AI, DevOps, etc.)
    - Grid of plugin cards: each card shows icon (from ICON_MAP), name, description, author, downloads count, and action button. If installed: "Installed" badge (disabled). If not: "Install" button that triggers useInstallPlugin mutation.
    - Active installs: for plugins currently installing, show inline progress bar with status text (Downloading... Installing... Configuring... Complete) reading from plugin-install-store.
    - Grid layout: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`

    **plugin-detail-panel.tsx**: Summary card at top of detail page showing plugin name, version, author, status badge, homepage link, permissions list (as badges), and action buttons (Disable/Enable, Uninstall, Check for Updates).

    **plugin-settings-form.tsx**: If plugin has configSchema, render a react-hook-form with FormField for each config key. Simple types: string -> Input, number -> Input type=number, boolean -> Switch. Save button with mutation. If no config, show "No configuration options" empty state.

    **plugin-agent-toggles.tsx**: Same pattern as skill-agent-toggles (Plan 01). List agents with Switch toggle. Shows agent name + avatar placeholder circle. Toggle calls useTogglePluginForAgent mutation. Optimistic UI.

    **plugin-detail-view.tsx**: Full detail page for /plugins/[pluginId]:
    - PageHeader with back link to /plugins
    - PluginDetailPanel at top
    - Tabs: "Settings" | "Agents" | "Documentation" | "Update History" using shadcn Tabs
    - Settings tab: PluginSettingsForm
    - Agents tab: PluginAgentToggles with description "Plugins are installed workspace-wide. Toggle per-agent access below."
    - Documentation tab: readme rendered with @uiw/react-md-editor in preview mode (dynamic import, ssr: false)
    - Update History tab: simple list of version entries with date and changelog text

    **plugins-list-view.tsx**: PageHeader ("Plugins") with action button linking to /plugins/install ("Install Plugin"). Renders PluginTable with usePlugins() data. Loading skeleton from shared LoadingSkeleton.

    **plugin-install-view.tsx**: PageHeader ("Install Plugin") with back link to /plugins. Renders PluginBrowser component.

    **Route pages**: Thin wrappers:
    - `app/(dashboard)/plugins/page.tsx`: renders PluginsListView
    - `app/(dashboard)/plugins/install/page.tsx`: renders PluginInstallView
    - `app/(dashboard)/plugins/[pluginId]/page.tsx`: async server component, await params, pass pluginId to PluginDetailView, include generateMetadata
  </action>
  <verify>Run `npx tsc --noEmit` -- no type errors. Navigate to /plugins (DataTable renders), /plugins/install (browser with cards), /plugins/[any-mock-id] (detail with tabs). Verify install button shows progress, action menu items work.</verify>
  <done>Installed plugins shown in DataTable at /plugins, plugin browser at /plugins/install lets users search and install with inline progress, and plugin detail page at /plugins/[pluginId] shows settings form, agent toggles, documentation, and update history.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. /plugins renders DataTable with 6-8 mock plugins showing name, version, status, last updated, action menu
3. /plugins/install renders card browser with search, category filters, and install buttons with progress
4. /plugins/[pluginId] renders detail with 4 tabs (Settings, Agents, Documentation, Update History)
5. StatusBadge colors correct for active/disabled/error
6. Per-agent toggle switches work with optimistic updates
</verification>

<success_criteria>
User can view installed plugins at /plugins in a sortable DataTable, browse and install plugins at /plugins/install with visual progress tracking, and configure individual plugins at /plugins/[pluginId] with settings form, per-agent toggles, documentation, and update history.
</success_criteria>

<output>
After completion, create `.planning/phases/09-skills-plugins-workflows/09-02-SUMMARY.md`
</output>
