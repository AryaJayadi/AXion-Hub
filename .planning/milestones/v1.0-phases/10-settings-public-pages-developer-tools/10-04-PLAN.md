---
phase: 10-settings-public-pages-developer-tools
plan: 04
type: execute
wave: 2
depends_on:
  - 10-01
files_modified:
  - src/features/settings/components/notification-prefs-form.tsx
  - src/features/settings/components/integration-cards.tsx
  - src/features/settings/components/backup-export-card.tsx
  - src/features/settings/components/danger-zone-card.tsx
  - src/features/settings/api/use-notifications.ts
  - src/features/settings/api/use-integrations.ts
  - src/features/settings/schemas/settings-schemas.ts
  - src/views/settings/settings-notifications-view.tsx
  - src/views/settings/settings-integrations-view.tsx
  - src/views/settings/settings-backup-view.tsx
  - src/views/settings/settings-danger-view.tsx
  - app/(dashboard)/settings/notifications/page.tsx
  - app/(dashboard)/settings/integrations/page.tsx
  - app/(dashboard)/settings/backup/page.tsx
  - app/(dashboard)/settings/danger/page.tsx
autonomous: true
requirements:
  - SETT-07
  - SETT-08
  - SETT-09
  - SETT-10

must_haves:
  truths:
    - "User can configure notification preferences (email, webhook, Slack/Discord) at /settings/notifications"
    - "User can see integration connection cards for GitHub, Linear, Jira at /settings/integrations"
    - "User can export workspace data as JSON at /settings/backup"
    - "User can access danger zone with type-workspace-name confirmation for destructive actions at /settings/danger"
  artifacts:
    - path: "src/features/settings/components/notification-prefs-form.tsx"
      provides: "Notification preferences form with channel toggles and webhook URL"
      min_lines: 50
    - path: "src/features/settings/components/integration-cards.tsx"
      provides: "Card grid for integration connections with status badges"
      min_lines: 50
    - path: "src/features/settings/components/danger-zone-card.tsx"
      provides: "Danger zone with type-to-confirm deletion using exact org name match"
      min_lines: 50
    - path: "src/features/settings/components/backup-export-card.tsx"
      provides: "Export cards for config, sessions, and full workspace data"
      min_lines: 40
  key_links:
    - from: "src/features/settings/components/danger-zone-card.tsx"
      to: "src/features/auth/lib/auth-client.ts"
      via: "authClient.organization.delete for workspace deletion"
      pattern: "organization.*delete"
    - from: "src/features/settings/components/notification-prefs-form.tsx"
      to: "src/features/settings/api/use-notifications.ts"
      via: "useSaveNotificationPrefs mutation"
      pattern: "useSaveNotificationPrefs"
---

<objective>
Build the remaining four settings pages: notifications, integrations, backup/export, and danger zone.

Purpose: Complete the settings surface by adding notification preference management, external service integration cards, data export capabilities, and destructive action controls with proper safety gates.

Output: /settings/notifications, /settings/integrations, /settings/backup, /settings/danger pages — all following the save-per-section Card pattern established in Plan 01.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-settings-public-pages-developer-tools/10-RESEARCH.md
@.planning/phases/10-settings-public-pages-developer-tools/10-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Notification preferences and integration connection cards</name>
  <files>
    src/features/settings/components/notification-prefs-form.tsx
    src/features/settings/components/integration-cards.tsx
    src/features/settings/api/use-notifications.ts
    src/features/settings/api/use-integrations.ts
    src/features/settings/schemas/settings-schemas.ts
    src/views/settings/settings-notifications-view.tsx
    src/views/settings/settings-integrations-view.tsx
    app/(dashboard)/settings/notifications/page.tsx
    app/(dashboard)/settings/integrations/page.tsx
  </files>
  <action>
    1. **Add schemas** to `src/features/settings/schemas/settings-schemas.ts`:
       - `notificationPrefsSchema`: Zod v4 schema with emailEnabled (boolean), webhookEnabled (boolean), webhookUrl (optional url string), slackEnabled (boolean), slackWebhookUrl (optional string), discordEnabled (boolean), discordWebhookUrl (optional string)

    2. **Create notification hooks** (`src/features/settings/api/use-notifications.ts`):
       - `useNotificationPrefs()`: TanStack Query hook returning mock notification prefs. Use queryKeys.settings.notifications() key.
       - `useSaveNotificationPrefs()`: mutation saving notification preferences (mock API). Cache invalidation + toast feedback.

    3. **NotificationPrefsForm** (`src/features/settings/components/notification-prefs-form.tsx`):
       - "use client" component accepting defaults prop
       - react-hook-form with zodResolver
       - Sections using Card groups:
         - **Email Notifications**: Switch toggle for enabled, description "Receive alerts and summaries via email"
         - **Webhook**: Switch toggle + conditionally shown URL Input when enabled. Description "Send events to a custom webhook endpoint"
         - **Slack**: Switch toggle + conditionally shown webhook URL Input. Description "Post notifications to a Slack channel"
         - **Discord**: Switch toggle + conditionally shown webhook URL Input. Description "Post notifications to a Discord channel"
       - Each channel is its own Card subsection within the form
       - Single Save button at the bottom for all notification preferences
       - Wrap entire form in a div with space-y-6

    4. **Create integration hooks** (`src/features/settings/api/use-integrations.ts`):
       - `useIntegrations()`: TanStack Query hook returning mock integration statuses. Returns array of { id, name, icon (lucide icon name), connected (boolean), lastSynced (Date | null), description (string) }.
       - Mock data: GitHub (connected), Linear (not connected), Jira (not connected)
       - `useConnectIntegration()`: mutation stub (shows toast "OAuth flow would start here")
       - `useDisconnectIntegration()`: mutation stub with optimistic status toggle

    5. **IntegrationCards** (`src/features/settings/components/integration-cards.tsx`):
       - "use client" component
       - Uses useIntegrations() hook
       - Renders a responsive grid of Cards (grid-cols-1 md:grid-cols-2 lg:grid-cols-3)
       - Each card shows: Service icon (Github, Trello, Briefcase from lucide), Service name, Description, Connection status Badge (Connected green / Not Connected gray), Last synced date (when connected), Connect/Disconnect Button
       - Connect button calls useConnectIntegration (stub for now — actual OAuth deferred)
       - Disconnect button shows confirmation then calls useDisconnectIntegration

    6. **Views and route pages**:
       - `src/views/settings/settings-notifications-view.tsx`: "use client", renders NotificationPrefsForm with defaults from useNotificationPrefs()
       - `src/views/settings/settings-integrations-view.tsx`: "use client", renders IntegrationCards
       - `app/(dashboard)/settings/notifications/page.tsx`: server component, metadata "Notifications - Settings"
       - `app/(dashboard)/settings/integrations/page.tsx`: server component, metadata "Integrations - Settings"
  </action>
  <verify>
    - `ls app/(dashboard)/settings/notifications/page.tsx app/(dashboard)/settings/integrations/page.tsx` both exist
    - `grep -r "Switch" src/features/settings/components/notification-prefs-form.tsx` confirms toggle usage
    - `grep -r "Connected\|Not Connected" src/features/settings/components/integration-cards.tsx` confirms status display
  </verify>
  <done>Notification preferences page shows per-channel toggles (email, webhook, Slack, Discord) with conditional URL inputs and Save button. Integrations page shows card grid with connection status, connect/disconnect buttons (OAuth stubs).</done>
</task>

<task type="auto">
  <name>Task 2: Backup/export and danger zone pages</name>
  <files>
    src/features/settings/components/backup-export-card.tsx
    src/features/settings/components/danger-zone-card.tsx
    src/views/settings/settings-backup-view.tsx
    src/views/settings/settings-danger-view.tsx
    app/(dashboard)/settings/backup/page.tsx
    app/(dashboard)/settings/danger/page.tsx
  </files>
  <action>
    1. **BackupExportCard** (`src/features/settings/components/backup-export-card.tsx`):
       - "use client" component
       - Three export options, each in its own Card:
         - **Configuration Export**: Button "Export Config" — downloads JSON with workspace settings, preferences, theme config. Mock: creates a JSON blob with { exportedAt, type: "config", data: { appName, timezone, theme, language } } and triggers download as `axion-config-{timestamp}.json`.
         - **Sessions Export**: Button "Export Sessions" — downloads JSON with session data. Mock: creates a JSON blob with session metadata. Download as `axion-sessions-{timestamp}.json`.
         - **Full Workspace Export**: Button "Export Everything" — downloads a comprehensive JSON export. Mock: creates JSON with config + agents + sessions metadata. Download as `axion-workspace-{timestamp}.json`.
       - Each card shows icon (Settings, MessageSquare, Archive from lucide), title, description, estimated size (mock), and download button
       - Download uses Blob + URL.createObjectURL + anchor click pattern (matching playground export from research)
       - Toast.success("Export started") on click, toast.success("Export downloaded") after blob creation

    2. **DangerZoneCard** (`src/features/settings/components/danger-zone-card.tsx`):
       - "use client" component
       - Visual treatment: Card with destructive red border (`border-destructive`), warning icon in header
       - Three destructive actions, each in its own section separated by Separator:
         - **Reset All Data**: Resets workspace data (agents, sessions, tasks) but keeps user accounts. Input to type organization name + "Reset Data" destructive button.
         - **Disconnect Gateway**: Disconnects from OpenClaw Gateway. Button with confirmation dialog.
         - **Delete Workspace**: Permanently deletes the entire workspace and all data. Input to type exact organization name + "Delete Workspace" destructive button.
       - Per user locked decision: type-workspace-name confirmation — user must type exact workspace/org name to confirm destructive actions. Use strict string comparison (no trim, no case-insensitive).
       - Pattern: `const canConfirm = confirmText === orgName;` — button disabled until exact match
       - Delete workspace calls `authClient.organization.delete({ organizationId })` on confirm
       - Reset and disconnect are mock stubs with toast feedback
       - Each action has a warning description explaining what will happen
       - All destructive buttons use `variant="destructive"` and show Loader2 while processing

    3. **Views and route pages**:
       - `src/views/settings/settings-backup-view.tsx`: "use client", renders BackupExportCard
       - `src/views/settings/settings-danger-view.tsx`: "use client", renders DangerZoneCard. Needs org name from useActiveOrganization().
       - `app/(dashboard)/settings/backup/page.tsx`: server component, metadata "Backup & Export - Settings"
       - `app/(dashboard)/settings/danger/page.tsx`: server component, metadata "Danger Zone - Settings"
  </action>
  <verify>
    - `ls app/(dashboard)/settings/backup/page.tsx app/(dashboard)/settings/danger/page.tsx` both exist
    - `grep -r "createObjectURL\|Blob" src/features/settings/components/backup-export-card.tsx` confirms download pattern
    - `grep -r "confirmText.*===.*orgName\|canConfirm\|canDelete" src/features/settings/components/danger-zone-card.tsx` confirms exact match pattern
    - `grep -r "organization.delete" src/features/settings/components/danger-zone-card.tsx` confirms delete API usage
  </verify>
  <done>Backup page shows three export options (config, sessions, full workspace) with JSON download. Danger zone shows destructive actions (reset data, disconnect gateway, delete workspace) with type-workspace-name exact-match confirmation gates and red visual treatment.</done>
</task>

</tasks>

<verification>
1. /settings/notifications shows email, webhook, Slack, Discord toggles with conditional URL fields
2. /settings/integrations shows card grid with GitHub (connected), Linear, Jira (not connected)
3. /settings/backup shows three export options that trigger JSON file downloads
4. /settings/danger shows red-bordered card with type-to-confirm for destructive actions
5. Delete workspace button only enables when exact org name is typed
6. All pages follow save-per-section Card pattern
</verification>

<success_criteria>
- Notification preferences save all channel toggles and webhook URLs
- Integration cards show connection status with connect/disconnect buttons
- Export buttons generate and download JSON files via Blob
- Danger zone type-to-confirm uses strict string comparison
- Delete workspace calls better-auth organization.delete
- All four settings pages render within the settings layout sidebar
</success_criteria>

<output>
After completion, create `.planning/phases/10-settings-public-pages-developer-tools/10-04-SUMMARY.md`
</output>
