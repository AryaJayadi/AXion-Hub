---
phase: 11-gap-closure-wiring-traceability
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/features/agents/components/agent-quick-actions.tsx
  - src/shared/ui/data-table.tsx
  - src/features/sessions/components/sessions-table.tsx
  - src/features/sessions/components/session-slide-over.tsx
  - .planning/REQUIREMENTS.md
autonomous: true
requirements:
  - AGNT-02
  - SESS-01

must_haves:
  truths:
    - "Agent detail 'Send Message' button navigates to /chat/[agentId]"
    - "All agent quick action buttons are enabled with working navigation targets"
    - "SessionsTable row click opens a slide-over panel (not full page navigation)"
    - "Session slide-over shows agent name, status, token usage, duration, and model"
    - "Session slide-over has 'View full transcript' link to /sessions/[sessionId]"
    - "DataTable has optional onRowClick prop for proper row click handling"
    - "No DOM event delegation pattern remains in SessionsTable"
    - "REQUIREMENTS.md SESS-01 shows [x] Complete after SessionsTable fix"
  artifacts:
    - path: "src/features/agents/components/agent-quick-actions.tsx"
      provides: "All quick actions enabled with working Link navigation"
      contains: "/chat/"
    - path: "src/shared/ui/data-table.tsx"
      provides: "DataTable with onRowClick callback prop"
      contains: "onRowClick"
    - path: "src/features/sessions/components/sessions-table.tsx"
      provides: "Sessions table using DataTable onRowClick instead of DOM delegation"
      contains: "onRowClick"
    - path: "src/features/sessions/components/session-slide-over.tsx"
      provides: "Session detail slide-over panel using Sheet component"
      contains: "SheetContent"
  key_links:
    - from: "src/features/agents/components/agent-quick-actions.tsx"
      to: "/chat/[agentId]"
      via: "Next.js Link component"
      pattern: '/chat/'
    - from: "src/features/sessions/components/sessions-table.tsx"
      to: "src/features/sessions/components/session-slide-over.tsx"
      via: "onRowClick -> setState -> Sheet open"
      pattern: "setSelectedSession"
    - from: "src/shared/ui/data-table.tsx"
      to: "consumer components"
      via: "onRowClick prop callback"
      pattern: "onRowClick.*row\\.original"
---

<objective>
Wire agent quick actions (especially "Send Message"), fix SessionsTable row click from DOM event delegation to proper callback, and add a session slide-over panel.

Purpose: "Send Message" is currently disabled with a Phase 4 TODO. SessionsTable uses fragile DOM event delegation that breaks with virtual scrolling. Clicking a session row should open a slide-over summary, not navigate to a full page.
Output: All agent quick actions work with navigation targets; DataTable has reusable onRowClick; SessionsTable uses it to open a Sheet-based slide-over.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/features/agents/components/agent-quick-actions.tsx
@src/shared/ui/data-table.tsx
@src/features/sessions/components/sessions-table.tsx
@src/features/missions/components/task-slide-over.tsx
@src/shared/ui/sheet.tsx
@src/entities/session
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire agent quick actions and add onRowClick to DataTable</name>
  <files>
    src/features/agents/components/agent-quick-actions.tsx
    src/shared/ui/data-table.tsx
  </files>
  <action>
**Part A: Fix agent-quick-actions.tsx**

Replace the entire disabled "Send Message" button block with an enabled Link-based button:

```typescript
{/* Send Message */}
<Button variant="outline" className="w-full justify-start gap-2" asChild>
    <Link href={`/chat/${agentId}`}>
        <MessageSquare className="size-4" />
        Send Message
    </Link>
</Button>
```

Remove the TooltipProvider/Tooltip wrapper and the disabled state. Remove the `Tooltip`, `TooltipContent`, `TooltipProvider`, `TooltipTrigger` imports since they are no longer used.

Verify all 4 quick actions now have working targets:
1. Send Message -> `/chat/${agentId}` (newly wired)
2. View Sessions -> `/agents/${agentId}/sessions` (already working)
3. Edit Identity -> `/agents/${agentId}/identity` (already working)
4. View Logs -> `/agents/${agentId}/logs` (already working)

Add `Link` import from `next/link` if not already imported (it is already imported).

**Part B: Add onRowClick to DataTable (data-table.tsx)**

1. Add `onRowClick` to the `DataTableProps` interface:
```typescript
/** Callback when a table row is clicked */
onRowClick?: (row: TData) => void;
```

2. Destructure `onRowClick` from props in the component function.

3. In the **non-virtualized table body** (the standard TableBody rendering), update each `<TableRow>`:
```typescript
<TableRow
    key={row.id}
    data-state={row.getIsSelected() ? "selected" : undefined}
    className={cn(onRowClick && "cursor-pointer")}
    onClick={() => onRowClick?.(row.original)}
>
```
Add the `cn` utility to the className (it should already be imported). Use conditional className to only show cursor-pointer when onRowClick is provided.

4. In the **virtualized table body** (the virtual scrolling branch), update each `<TableRow>` similarly:
```typescript
<TableRow
    key={row.id}
    data-index={virtualRow.index}
    className={cn(onRowClick && "cursor-pointer")}
    onClick={() => onRowClick?.(row.original)}
>
```

This is a purely additive, non-breaking change. Existing DataTable consumers without onRowClick are unaffected.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Verify agent-quick-actions.tsx has 4 enabled Button+Link pairs. Verify data-table.tsx interface includes `onRowClick?: (row: TData) => void`.
  </verify>
  <done>
All agent quick actions are enabled with working navigation targets. DataTable has a reusable onRowClick prop that properly passes row data to the callback.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix SessionsTable row click and create session slide-over</name>
  <files>
    src/features/sessions/components/session-slide-over.tsx
    src/features/sessions/components/sessions-table.tsx
    .planning/REQUIREMENTS.md
  </files>
  <action>
**Part A: Create session-slide-over.tsx**

Create `src/features/sessions/components/session-slide-over.tsx` following the TaskSlideOver pattern from `src/features/missions/components/task-slide-over.tsx`:

```typescript
"use client";

import Link from "next/link";
import { Clock, Bot, Cpu, Hash, Timer } from "lucide-react";
import type { CrossAgentSession } from "@/entities/session";
import { Button } from "@/shared/ui/button";
import { Badge } from "@/shared/ui/badge";
import { StatusBadge } from "@/shared/ui/status-badge";
import {
    Sheet,
    SheetContent,
    SheetDescription,
    SheetFooter,
    SheetHeader,
    SheetTitle,
} from "@/shared/ui/sheet";

interface SessionSlideOverProps {
    session: CrossAgentSession | null;
    open: boolean;
    onClose: () => void;
}

export function SessionSlideOver({ session, open, onClose }: SessionSlideOverProps) {
    // ... component body
}
```

The slide-over should display:
- **Header**: Agent name + "Session" as title, session ID as description
- **Status**: StatusBadge showing session status
- **Agent**: Agent name with Bot icon
- **Model**: Model name with Cpu icon
- **Tokens**: Token count formatted (e.g., "4.2K") with Hash icon
- **Duration**: Computed from startedAt/endedAt, or "Active" if still running, with Timer icon
- **Started**: Relative time (e.g., "2 hours ago") with Clock icon
- **Footer**: "View full transcript" Button as a Link to `/sessions/${session.id}`

Use `<Sheet open={open} onOpenChange={(isOpen) => !isOpen && onClose()}>` pattern.
Content goes in `<SheetContent side="right" className="w-full sm:max-w-md">`.

Format token count: `count >= 1000 ? (count / 1000).toFixed(1) + "K" : count.toLocaleString()`.
Format duration: compute from startedAt/endedAt as minutes/hours string, or "Active" if endedAt is null.

**Part B: Refactor SessionsTable to use DataTable onRowClick + slide-over**

Update `src/features/sessions/components/sessions-table.tsx`:

1. **Add state for slide-over:**
```typescript
const [selectedSession, setSelectedSession] = useState<CrossAgentSession | null>(null);
```

2. **Replace handleRowClick** to open slide-over instead of navigating:
```typescript
const handleRowClick = (session: CrossAgentSession) => {
    setSelectedSession(session);
};
```
(Remove the `router.push` call and `useRouter` import since we're using slide-over now.)

3. **Remove all DOM event delegation** from both the chronological view and AgentGroup:

For the **chronological view**, replace the wrapper div+onClick with DataTable's onRowClick:
```typescript
// Before: <div className="..." onClick={(e) => { const row = ... }}>
//           <DataTable columns={columns} data={sortedSessions} ... />
//         </div>

// After:
<DataTable
    columns={columns}
    data={sortedSessions}
    enablePagination
    pageSize={10}
    onRowClick={handleRowClick}
/>
```
Remove the wrapping div with the `[&_tbody_tr]` CSS selectors entirely.

For the **AgentGroup component**:
a. Change props: `onRowClick: (session: CrossAgentSession) => void` (was `(sessionId: string) => void`)
b. Remove the `handleClick` function with DOM traversal entirely
c. Remove the wrapping div with `[&_tbody_tr]` CSS selectors
d. Pass `onRowClick` to DataTable:
```typescript
<DataTable
    columns={groupedColumns}
    data={sessions}
    enablePagination={false}
    onRowClick={onRowClick}
/>
```

4. **Render SessionSlideOver** at the bottom of SessionsTable:
```typescript
import { SessionSlideOver } from "./session-slide-over";

// Inside the return, after the main content:
<SessionSlideOver
    session={selectedSession}
    open={selectedSession !== null}
    onClose={() => setSelectedSession(null)}
/>
```

5. **Remove unused imports**: `useRouter` from `next/navigation`, remove `cn` if no longer used in this file.

**Part C: Mark SESS-01 as Complete in REQUIREMENTS.md**

After the SessionsTable fix is in place, update `.planning/REQUIREMENTS.md`:

1. Change `- [ ] **SESS-01**` to `- [x] **SESS-01**`
2. In the traceability table, update SESS-01 status from `Pending` to `Complete` and phase from `Phase 11 Pending` to `Phase 11`
3. Update the Coverage section: change "Pending (gap closure): 1 (SESS-01 -> Phase 11)" to reflect 0 pending gap closures, and increment the completed count accordingly
4. Update "Last updated" date to current date

This closes the traceability loop: the SessionsTable callback fix satisfies SESS-01, so the requirement should reflect completion.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Verify sessions-table.tsx has no DOM event delegation (no `closest("tbody tr")`, no `parentElement.children`). Verify SessionSlideOver renders a Sheet with session summary fields and a transcript link.
  </verify>
  <done>
SessionsTable uses DataTable's onRowClick prop for proper component-level row click handling. Clicking a row opens a slide-over panel showing session summary (agent, status, tokens, duration, model) with a "View full transcript" link. No DOM event delegation remains. REQUIREMENTS.md SESS-01 is marked [x] Complete.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. All 4 agent quick actions are enabled with working Link navigation
3. DataTable has `onRowClick?: (row: TData) => void` prop
4. SessionsTable uses DataTable's onRowClick (no DOM delegation)
5. Session slide-over opens on row click with summary fields
6. Slide-over has "View full transcript" link to /sessions/[sessionId]
7. No `closest("tbody tr")` or `parentElement.children` patterns remain
8. REQUIREMENTS.md SESS-01 shows `[x]` Complete
</verification>

<success_criteria>
- "Send Message" quick action navigates to /chat/[agentId]
- SessionsTable row click opens slide-over panel with session summary
- Slide-over shows agent name, status, tokens, duration, model, and transcript link
- DataTable's onRowClick is a reusable addition (non-breaking for existing consumers)
</success_criteria>

<output>
After completion, create `.planning/phases/11-gap-closure-wiring-traceability/11-03-SUMMARY.md`
</output>
