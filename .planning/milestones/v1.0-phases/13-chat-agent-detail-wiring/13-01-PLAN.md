---
phase: 13-chat-agent-detail-wiring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/features/chat/components/chat-layout.tsx
  - src/features/dashboard/components/quick-actions.tsx
autonomous: true
requirements:
  - CHAT-01
  - DASH-07
  - AGNT-01

must_haves:
  truths:
    - "Navigating directly to /chat populates the AgentPickerDialog with agents (no prior /agents visit required)"
    - "Dashboard 'Send Message' quick action navigates to /chat"
    - "No toast.info stub remains for Send Message — silent navigation replaces it"
  artifacts:
    - path: "src/features/chat/components/chat-layout.tsx"
      provides: "Agent store hydration for chat entry"
      contains: "useAgents()"
    - path: "src/features/dashboard/components/quick-actions.tsx"
      provides: "Send Message navigation link"
      contains: "Link href=\"/chat\""
  key_links:
    - from: "src/features/chat/components/chat-layout.tsx"
      to: "src/features/agents/api/use-agents.ts"
      via: "useAgents() hook call hydrating Zustand agent store"
      pattern: "useAgents\\(\\)"
    - from: "src/features/dashboard/components/quick-actions.tsx"
      to: "/chat"
      via: "Next.js Link with asChild pattern"
      pattern: "href=\"/chat\""
---

<objective>
Wire chat entry points from dashboard and direct URL navigation so the agent store is populated when users reach /chat, and the dashboard "Send Message" button navigates to /chat instead of showing a toast stub.

Purpose: Closes INT-03 (agent store empty on direct /chat navigation) and INT-04 (Send Message shows "Coming soon" toast instead of navigating).
Output: Two modified files enabling end-to-end dashboard-to-chat and direct-URL-to-chat flows.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-chat-agent-detail-wiring/13-CONTEXT.md
@.planning/phases/13-chat-agent-detail-wiring/13-RESEARCH.md
@src/features/chat/components/chat-layout.tsx
@src/features/dashboard/components/quick-actions.tsx
@src/features/agents/api/use-agents.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Hydrate agent store in ChatLayout for direct /chat navigation</name>
  <files>src/features/chat/components/chat-layout.tsx</files>
  <action>
Add `useAgents()` call inside the `ChatLayout` component to ensure the Zustand agent store is populated when users navigate directly to `/chat` (without visiting `/agents` first).

1. Add import: `import { useAgents } from "@/features/agents/api/use-agents";`
2. Inside the `ChatLayout` function body, before the `return` statement, add a call: `useAgents();`
3. Add a brief inline comment: `// Hydrate agent store for AgentPickerDialog (handles direct /chat navigation)`

Per CONTEXT.md locked decisions:
- Call `useAgents()` in ChatLayout — the outermost client component owning the chat UI tree
- Do NOT call it in the route layout (`app/(dashboard)/chat/layout.tsx`) — that is a server component
- Do NOT call it inside `AgentPickerDialog` — agents should load before the dialog opens
- TanStack Query deduplicates: if store already has agents (user came from /agents), the query resolves instantly from cache. staleTime: Infinity prevents unnecessary refetches.
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no TypeScript errors. Verify the import resolves correctly and the hook call is inside a "use client" component.</verify>
  <done>ChatLayout calls useAgents() before rendering, ensuring the agent store is populated on direct /chat navigation. AgentPickerDialog can read agents from the store immediately.</done>
</task>

<task type="auto">
  <name>Task 2: Replace Send Message toast stub with Link navigation to /chat</name>
  <files>src/features/dashboard/components/quick-actions.tsx</files>
  <action>
Replace the dashboard "Send Message" button (which currently shows a `toast.info("Coming soon")` stub) with a `<Link href="/chat">` using the shadcn `asChild` pattern, matching the existing "New Agent" and "New Task" buttons.

1. Replace the Send Message `<Button onClick={...}>` block (lines 30-41) with:
   ```tsx
   <Button variant="outline" size="sm" asChild>
     <Link href="/chat">
       <MessageSquare className="size-4" />
       Send Message
     </Link>
   </Button>
   ```
2. Remove the `toast` import from "sonner" — it becomes unused.
3. Keep the `Link` import from "next/link" (already present for the other buttons).
4. Keep the `MessageSquare` import from "lucide-react" (still used by the button).

Per CONTEXT.md locked decisions:
- No AgentPickerDialog auto-open on arrival — user clicks "New Chat" from the chat hub
- Remove the `toast.info()` stub entirely — silent navigation, no confirmation toast
- Use `asChild` pattern matching existing buttons in the same component
  </action>
  <verify>Run `npx tsc --noEmit` to confirm no TypeScript errors. Verify that the `toast` and `sonner` imports are removed. Verify the Send Message button matches the structure of the "New Agent" button (asChild + Link).</verify>
  <done>Dashboard "Send Message" navigates to /chat via client-side Link routing. No toast stub remains. The button matches the visual pattern of "New Agent" and "New Task" buttons.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. In `chat-layout.tsx`: `useAgents()` is called inside the ChatLayout function body with the correct import
3. In `quick-actions.tsx`: "Send Message" uses `<Button asChild><Link href="/chat">` pattern; no `toast` or `sonner` imports remain
4. No other files in the codebase are modified
</verification>

<success_criteria>
- ChatLayout calls useAgents() ensuring agent store hydration on direct /chat navigation
- Dashboard Send Message button navigates to /chat using Link (no toast stub)
- TypeScript compilation succeeds
- Both files follow existing codebase patterns (asChild for Link buttons, useAgents for store hydration)
</success_criteria>

<output>
After completion, create `.planning/phases/13-chat-agent-detail-wiring/13-01-SUMMARY.md`
</output>
