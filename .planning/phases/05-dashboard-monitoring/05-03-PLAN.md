---
phase: 05-dashboard-monitoring
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/features/dashboard/components/activity-feed-widget.tsx
  - src/features/dashboard/components/activity-event-card.tsx
  - src/features/dashboard/components/quick-actions.tsx
  - src/features/dashboard/lib/use-auto-scroll.ts
autonomous: true
requirements: [DASH-06, DASH-07]

must_haves:
  truths:
    - "User sees a live activity feed showing the last 20 events in real time"
    - "New events push in at the top without disrupting scroll position when user is reading older events"
    - "A 'New events' indicator appears when user has scrolled down and new events arrive"
    - "Quick action buttons for New Task, New Agent, and Send Message are visible on the dashboard"
  artifacts:
    - path: "src/features/dashboard/components/activity-feed-widget.tsx"
      provides: "Live activity feed with scroll-aware auto-scroll"
    - path: "src/features/dashboard/components/activity-event-card.tsx"
      provides: "Single event card display"
    - path: "src/features/dashboard/components/quick-actions.tsx"
      provides: "Quick action buttons"
    - path: "src/features/dashboard/lib/use-auto-scroll.ts"
      provides: "Scroll-position-aware auto-scroll hook"
  key_links:
    - from: "src/features/dashboard/components/activity-feed-widget.tsx"
      to: "src/features/dashboard/model/activity-store.ts"
      via: "useActivityStore for events"
      pattern: "useActivityStore"
    - from: "src/features/dashboard/lib/use-auto-scroll.ts"
      to: "src/features/dashboard/components/activity-feed-widget.tsx"
      via: "Hook used for scroll management"
      pattern: "useAutoScroll"
---

<objective>
Build the live activity feed widget with scroll-position-aware auto-scroll, individual event cards, and dashboard quick action buttons.

Purpose: Deliver DASH-06 (live activity feed) and DASH-07 (quick actions). The activity feed is the most visually prominent widget per user decision and streams the last 20 events in real time via WebSocket. Quick actions provide one-click access to common workflows.

Output: Activity feed widget, event card component, auto-scroll hook, and quick actions component.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-dashboard-monitoring/05-RESEARCH.md
@.planning/phases/05-dashboard-monitoring/05-01-SUMMARY.md
@src/features/dashboard/model/activity-store.ts
@src/features/dashboard/lib/event-mapper.ts
@src/entities/dashboard-event/model/types.ts
@src/shared/ui/scroll-area.tsx
@src/shared/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build auto-scroll hook, event card, and activity feed widget</name>
  <files>
    src/features/dashboard/lib/use-auto-scroll.ts
    src/features/dashboard/components/activity-event-card.tsx
    src/features/dashboard/components/activity-feed-widget.tsx
  </files>
  <action>
    1. Create `src/features/dashboard/lib/use-auto-scroll.ts`:
       - Per locked decision: "Activity feed auto-scrolls with new events pushing in at the top; if user has scrolled down, show a 'New events' indicator instead of disrupting position"
       - `useAutoScroll(containerRef: React.RefObject<HTMLElement | null>)` hook returning:
         - `isAtTop`: boolean -- whether user is within 50px of the top
         - `newEventCount`: number -- events received while scrolled away
         - `handleScroll`: callback for scroll event listener
         - `scrollToTop`: function to smooth-scroll to top and reset count
         - `onNewEvent`: function called when a new event arrives; if isAtTop, no-op (events appear naturally); if not at top, increment newEventCount
       - Implementation: Use `useCallback` and `useState`. `handleScroll` reads `containerRef.current.scrollTop` and sets `isAtTop` to `scrollTop < 50`. When `isAtTop` becomes true, reset `newEventCount` to 0.

    2. Create `src/features/dashboard/components/activity-event-card.tsx`:
       - "use client" component
       - Props: `event: DashboardEvent`
       - Import `getEventDisplayInfo` from `@/features/dashboard/lib/event-mapper`
       - Display: icon (from lucide-react, mapped via getEventDisplayInfo), event summary text, relative timestamp (using date-fns `formatDistanceToNow`), severity indicator (colored dot)
       - Compact card design: horizontal row with icon | summary | timestamp
       - Use subtle hover state for future click-to-expand
       - Color the left border or icon background based on event type (blue for agent, green for chat, orange for exec, purple for system)

    3. Create `src/features/dashboard/components/activity-feed-widget.tsx`:
       - "use client" component
       - Per locked decision: "Activity feed is the most visually prominent widget, takes the largest grid area"
       - Import `useActivityStore` from `@/features/dashboard`
       - Import `useAutoScroll` from the lib
       - Import `ActivityEventCard` from above
       - Import `ScrollArea` from `@/shared/ui/scroll-area`
       - Import `EmptyState` from `@/shared/ui/empty-state`

       Implementation:
       - Read events from `useActivityStore(s => s.events)` (max 20 for dashboard)
       - Create a `containerRef` with `useRef<HTMLDivElement>(null)`
       - Use the `useAutoScroll(containerRef)` hook
       - Call `onNewEvent()` via useEffect when events array length changes
       - Render a ScrollArea wrapping a div with ref={containerRef} and onScroll={handleScroll}
       - Map events to ActivityEventCard components (key by event.id)
       - When `newEventCount > 0` and not at top, show a floating "pill" button at the top: "{N} new events" with a ChevronUp icon. Clicking calls `scrollToTop()`.
       - When events array is empty, show EmptyState with "No activity yet" message
       - The widget card should have a header with "Activity Feed" title and a small live indicator dot (pulsing green animation)
       - Set a fixed max height for the scroll container (e.g., h-[500px] or let the bento grid row-span handle it)
  </action>
  <verify>
    Run `bun run build` -- zero TypeScript errors. Verify all 3 files exist. Verify useAutoScroll hook exports correctly. Verify ActivityFeedWidget imports from activity store.
  </verify>
  <done>
    Activity feed widget renders with scroll-position-aware auto-scroll. New events pill appears when user scrolls down. Event cards show icon, summary, timestamp, and severity. Empty state shown when no events. The widget is ready to be placed in the dashboard bento grid.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build quick actions and wire feed + actions into DashboardView</name>
  <files>
    src/features/dashboard/components/quick-actions.tsx
    src/views/dashboard/dashboard-view.tsx
  </files>
  <action>
    1. Create `src/features/dashboard/components/quick-actions.tsx`:
       - Per requirement DASH-07: "Dashboard provides quick actions: New Task, New Agent, Send Message"
       - "use client" component
       - Import `Button` from `@/shared/ui/button`
       - Import `Link` from `next/link`
       - Import lucide icons: `Plus`, `Bot`, `MessageSquare`, `ListTodo`
       - Render three action buttons:
         - "New Agent" -- links to `/agents/new` (existing route from Phase 3)
         - "New Task" -- links to `/missions/new` (Phase 6 route, not yet created -- use the link anyway, it will 404 gracefully and the route will be created in Phase 6)
         - "Send Message" -- opens a dialog trigger (for now, show a toast "Coming soon â€” available when Mission Board launches" using sonner, similar to how Phase 3 disabled it with tooltip)
       - Button style: outline variant with icon + text, compact sizing
       - Layout: horizontal row of buttons with gap-2, wrapping on mobile (flex-wrap)
       - Claude's discretion on exact placement: place as a row above or below the bento grid, not inside a grid cell (keeps it accessible and always visible)

    2. Update `src/views/dashboard/dashboard-view.tsx`:
       - Import `ActivityFeedWidget` from `@/features/dashboard/components/activity-feed-widget`
       - Import `QuickActions` from `@/features/dashboard/components/quick-actions`
       - Replace the activity feed placeholder slot with the actual `<ActivityFeedWidget />` wrapped in a `<BentoGridItem>` with the largest grid span: `col-span-1 md:col-span-2 lg:col-span-2 row-span-3` (tallest widget, most prominent)
       - Add `<QuickActions />` between the PageHeader and the DegradedModeBanner (or between banner and grid -- Claude's discretion on exact placement for best visual hierarchy)
       - Ensure the dashboard page composition is complete: header -> quick actions -> degraded banner -> bento grid with all widgets
  </action>
  <verify>
    Run `bun run build` -- zero errors. Verify DashboardView imports ActivityFeedWidget and QuickActions. Verify quick actions link to /agents/new. Verify the activity feed slot is no longer a placeholder.
  </verify>
  <done>
    Quick actions bar renders three buttons (New Agent, New Task, Send Message) above the dashboard grid. Activity feed widget is wired into the bento grid as the most prominent widget. The /dashboard page is now a complete command center with all DASH-01 through DASH-07 widgets visible.
  </done>
</task>

</tasks>

<verification>
1. `bun run build` passes with zero errors
2. Activity feed widget renders events from activity store
3. Auto-scroll hook detects scroll position and shows "New events" pill
4. Event cards show icon, summary, timestamp, and severity
5. Quick actions bar has New Agent, New Task, Send Message buttons
6. DashboardView includes all widgets in the bento grid
7. Activity feed is the largest widget in the grid
</verification>

<success_criteria>
- Activity feed widget shows last 20 events with auto-scroll behavior
- "New events" pill appears when user scrolls down and events arrive
- Event cards display type-colored icon, summary text, and relative timestamp
- Quick actions provide links to /agents/new, /missions/new, and a Send Message action
- DashboardView is fully composed with all dashboard widgets
- `bun run build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard-monitoring/05-03-SUMMARY.md`
</output>
