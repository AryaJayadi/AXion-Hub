---
phase: 02-authentication-app-shell
plan: 02
type: execute
wave: 2
depends_on:
  - "02-01"
files_modified:
  - app/(auth)/layout.tsx
  - app/(auth)/login/page.tsx
  - app/(auth)/register/page.tsx
  - app/(auth)/forgot-password/page.tsx
  - app/(auth)/reset-password/page.tsx
  - app/(auth)/verify-email/page.tsx
  - src/features/auth/components/auth-layout.tsx
  - src/features/auth/components/login-form.tsx
  - src/features/auth/components/register-form.tsx
  - src/features/auth/components/forgot-password-form.tsx
  - src/features/auth/components/reset-password-form.tsx
  - src/features/auth/components/social-login-buttons.tsx
autonomous: true
requirements:
  - AUTH-01
  - AUTH-02
  - AUTH-03
  - AUTH-04

must_haves:
  truths:
    - "User can visit /login and see a split-screen page with branding on left and email/password form on right"
    - "User can submit login form with email and password and be redirected to last visited page"
    - "User can click Google or GitHub OAuth buttons below the email/password form to sign in via OAuth"
    - "User can visit /register and create an account with name, email, password, and ToS checkbox"
    - "User can visit /forgot-password, enter email, and receive a password reset link"
    - "User can visit /reset-password?token=... and set a new password"
    - "User can visit /verify-email and see confirmation after clicking verification link from email"
    - "All auth forms show inline field-level validation errors and top-level server errors"
  artifacts:
    - path: "app/(auth)/layout.tsx"
      provides: "Auth route group layout"
      min_lines: 5
    - path: "app/(auth)/login/page.tsx"
      provides: "Login page"
      contains: "LoginForm"
    - path: "app/(auth)/register/page.tsx"
      provides: "Register page"
      contains: "RegisterForm"
    - path: "app/(auth)/forgot-password/page.tsx"
      provides: "Forgot password page"
      contains: "ForgotPasswordForm"
    - path: "app/(auth)/reset-password/page.tsx"
      provides: "Reset password page"
      contains: "ResetPasswordForm"
    - path: "app/(auth)/verify-email/page.tsx"
      provides: "Email verification landing page"
      min_lines: 10
    - path: "src/features/auth/components/auth-layout.tsx"
      provides: "Split-screen layout wrapper for auth pages"
      contains: "grid"
    - path: "src/features/auth/components/login-form.tsx"
      provides: "Login form with email/password + social login"
      contains: "signIn"
    - path: "src/features/auth/components/register-form.tsx"
      provides: "Registration form with name, email, password, ToS"
      contains: "signUp"
    - path: "src/features/auth/components/social-login-buttons.tsx"
      provides: "Google and GitHub OAuth buttons"
      contains: "signIn.social"
  key_links:
    - from: "src/features/auth/components/login-form.tsx"
      to: "src/features/auth/lib/auth-client.ts"
      via: "signIn.email for credential login"
      pattern: "signIn\\.email"
    - from: "src/features/auth/components/register-form.tsx"
      to: "src/features/auth/lib/auth-client.ts"
      via: "signUp.email for registration"
      pattern: "signUp\\.email"
    - from: "src/features/auth/components/social-login-buttons.tsx"
      to: "src/features/auth/lib/auth-client.ts"
      via: "signIn.social for OAuth"
      pattern: "signIn\\.social"
    - from: "src/features/auth/components/login-form.tsx"
      to: "src/features/auth/schemas/auth-schemas.ts"
      via: "zodResolver(loginSchema) for form validation"
      pattern: "loginSchema"
    - from: "src/features/auth/components/register-form.tsx"
      to: "src/features/auth/schemas/auth-schemas.ts"
      via: "zodResolver(registerSchema) for form validation"
      pattern: "registerSchema"
---

<objective>
Build all authentication pages: login, register, forgot-password, reset-password, and verify-email. Each page uses the split-screen auth layout with branding on the left and the form on the right. Forms use react-hook-form + zod for validation and better-auth client for API calls.

Purpose: Give users the complete authentication experience — creating accounts, signing in with email or OAuth, and recovering passwords.
Output: 5 fully functional auth pages with validated forms, OAuth buttons, loading states, and error handling.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-authentication-app-shell/02-RESEARCH.md
@.planning/phases/02-authentication-app-shell/02-CONTEXT.md
@.planning/phases/02-authentication-app-shell/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui components and create shared auth layout + social login buttons</name>
  <files>
    src/features/auth/components/auth-layout.tsx
    src/features/auth/components/social-login-buttons.tsx
    app/(auth)/layout.tsx
  </files>
  <action>
    **1. Install required shadcn/ui components** (if not already installed by Phase 1):
    ```bash
    bunx shadcn@latest add button input card separator checkbox form tooltip
    ```
    These components install to `src/shared/ui/` per the components.json aliases.

    **2. Auth layout wrapper** (`src/features/auth/components/auth-layout.tsx`):
    Based on shadcn/ui login-02 block pattern. Split-screen: `grid min-h-svh lg:grid-cols-2`.

    Left side (branding side -- per locked decision: branding on left):
    - `bg-muted relative hidden lg:block` (hidden on mobile)
    - Dark gradient background using theme colors. Use a `div` with gradient from a dark background shade to a subtle primary color tint
    - Center: AXion Hub logo large + tagline "Mission Control for AI Agents"
    - Subtle geometric grid pattern using CSS (background-image with repeating linear gradients creating a grid effect, very low opacity ~0.05)

    Right side (form side):
    - Top: AXion Hub logo + name link (use `GalleryVerticalEnd` or custom icon from lucide-react, `bg-primary text-primary-foreground` icon box)
    - Center: `flex flex-1 items-center justify-center` wrapping a `max-w-sm` container
    - Content: heading (`text-2xl font-bold`), description (`text-muted-foreground text-sm text-balance`), then `{children}` (the form)

    Props: `children`, `heading: string`, `description: string`.

    **3. Social login buttons** (`src/features/auth/components/social-login-buttons.tsx`):
    Mark as `"use client"`. Two buttons: Google and GitHub.
    - Accept `callbackUrl` prop (passed through to signIn.social)
    - Each button calls `authClient.signIn.social({ provider: "google"|"github", callbackURL: callbackUrl })`
    - Show loading state per-button (track which provider is loading)
    - Use shadcn Button with `variant="outline"` and full width
    - Include Google and GitHub SVG icons inline (simple path-based SVGs, not external libraries)
    - Separator above buttons: "Or continue with" text between horizontal lines (use shadcn Separator or flex with lines)

    **4. Auth route group layout** (`app/(auth)/layout.tsx`):
    Simple layout that wraps children. If session exists (check via `auth.api.getSession` with `headers()`), redirect to `/`. Otherwise render children. This prevents authenticated users from seeing auth pages even if proxy.ts cookie check fails.
  </action>
  <verify>
    - `bun run build` passes
    - `src/features/auth/components/auth-layout.tsx` renders a two-column grid
    - `src/features/auth/components/social-login-buttons.tsx` exports SocialLoginButtons component
    - `app/(auth)/layout.tsx` exists and checks session
    - All shadcn/ui components installed in `src/shared/ui/`
  </verify>
  <done>
    Split-screen auth layout renders with branding panel on left (desktop) and form area on right. Social login buttons component ready with Google and GitHub OAuth. Auth route group layout redirects authenticated users.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build login, register, forgot-password, reset-password, and verify-email pages</name>
  <files>
    src/features/auth/components/login-form.tsx
    src/features/auth/components/register-form.tsx
    src/features/auth/components/forgot-password-form.tsx
    src/features/auth/components/reset-password-form.tsx
    app/(auth)/login/page.tsx
    app/(auth)/register/page.tsx
    app/(auth)/forgot-password/page.tsx
    app/(auth)/reset-password/page.tsx
    app/(auth)/verify-email/page.tsx
  </files>
  <action>
    **All form components** are `"use client"`, use react-hook-form with `zodResolver`, and follow the same pattern:
    - `useForm<T>({ resolver: zodResolver(schema), defaultValues: {...} })`
    - Loading state via `useState<boolean>(false)` (or `formState.isSubmitting`)
    - Error state via `useState<string | null>(null)` for server errors
    - All inputs disabled during submission
    - Submit button shows spinner + loading text during submission
    - Field-level errors shown below each input via shadcn form components
    - Server errors shown as an alert at the top of the form (use a styled div with `bg-destructive/10 text-destructive border border-destructive/20 rounded-md p-3`)

    **1. Login form** (`src/features/auth/components/login-form.tsx`):
    - Fields: email (Input type="email"), password (Input type="password")
    - Uses `loginSchema` from auth-schemas
    - On submit: call `authClient.signIn.email({ email, password, callbackURL })` where callbackURL comes from `useSearchParams().get("callbackUrl") || "/"`
    - Handle 403 error (email not verified) with specific message "Please verify your email address before signing in."
    - Handle other errors with "Invalid email or password. Please try again."
    - On success: `router.push(callbackUrl)`
    - Below form: "Forgot your password?" link to `/forgot-password`
    - Below that: `<SocialLoginButtons callbackUrl={callbackUrl} />`
    - Below social buttons: "Don't have an account? Sign up" link to `/register`

    **2. Register form** (`src/features/auth/components/register-form.tsx`):
    - Fields: name (Input), email (Input type="email"), password (Input type="password"), agreeToTerms (Checkbox)
    - Uses `registerSchema` from auth-schemas
    - Password field: show strength indicator below (a simple colored bar: red < 8 chars, yellow 8-11 chars, green 12+ chars with all criteria met). Use width + color transitions.
    - ToS checkbox: "I agree to the [Terms of Service](/terms) and [Privacy Policy](/privacy)" with links (per locked decision)
    - On submit: call `authClient.signUp.email({ name, email, password })`. Do NOT pass callbackURL — after registration, user needs to verify email first.
    - On success: redirect to `/verify-email?email={email}` to show "Check your inbox" message
    - Handle "User already exists" error
    - Below form: "Already have an account? Sign in" link to `/login`

    **3. Forgot password form** (`src/features/auth/components/forgot-password-form.tsx`):
    - Fields: email (Input type="email")
    - Uses `forgotPasswordSchema` from auth-schemas
    - On submit: call `authClient.forgetPassword({ email, redirectTo: "/reset-password" })`
    - On success: show success message "If an account exists with this email, you'll receive a password reset link." (do not confirm whether email exists — security)
    - Below form: "Back to login" link to `/login`

    **4. Reset password form** (`src/features/auth/components/reset-password-form.tsx`):
    - Fields: newPassword (Input type="password"), confirmPassword (Input type="password")
    - Uses `resetPasswordSchema` from auth-schemas
    - Read `token` from URL search params
    - On submit: call `authClient.resetPassword({ newPassword, token })`
    - On success: show success message + redirect to `/login` after 3 seconds
    - Handle invalid/expired token error

    **5. Verify email page** (`app/(auth)/verify-email/page.tsx`):
    This page has TWO modes:
    - **Waiting mode** (no token in URL): Show "Check your inbox" message with the email from search params. Include "Resend verification email" button that calls `authClient.sendVerificationEmail({ email })`.
    - **Verifying mode** (token in URL, handled by better-auth automatically): better-auth handles the `/api/auth/verify-email?token=...` endpoint internally. This page shows a success state with "Email verified! Redirecting..." and auto-redirects to `/login` (or the app if autoSignInAfterVerification works).

    **6. Page files** — Each page wraps its form in the AuthLayout:
    - `app/(auth)/login/page.tsx`: `<AuthLayout heading="Welcome back" description="Sign in to your AXion Hub account"><LoginForm /></AuthLayout>`
    - `app/(auth)/register/page.tsx`: `<AuthLayout heading="Create an account" description="Get started with AXion Hub"><RegisterForm /></AuthLayout>`
    - `app/(auth)/forgot-password/page.tsx`: `<AuthLayout heading="Forgot your password?" description="Enter your email and we'll send you a reset link"><ForgotPasswordForm /></AuthLayout>`
    - `app/(auth)/reset-password/page.tsx`: `<AuthLayout heading="Reset your password" description="Enter your new password below"><ResetPasswordForm /></AuthLayout>`
    - `app/(auth)/verify-email/page.tsx`: `<AuthLayout heading="Verify your email" description="..."><VerifyEmailContent /></AuthLayout>`

    Wrap components that use `useSearchParams()` in a `<Suspense>` boundary to avoid Next.js build errors.
  </action>
  <verify>
    - `bun run build` passes without errors
    - All 5 page files exist under `app/(auth)/`
    - All 4 form components exist under `src/features/auth/components/`
    - Login form imports and uses `loginSchema`, `signIn.email`, `SocialLoginButtons`
    - Register form imports and uses `registerSchema`, `signUp.email`, checkbox for ToS
    - Forgot-password form uses `forgotPasswordSchema`, `forgetPassword`
    - Reset-password form uses `resetPasswordSchema`, `resetPassword`, reads token from URL
    - Each page wraps its form in `AuthLayout` with appropriate heading/description
  </verify>
  <done>
    All 5 auth pages are functional: /login with email/password + OAuth + callbackUrl redirect, /register with name/email/password/ToS + email verification redirect, /forgot-password with reset email request, /reset-password with token-based password change, /verify-email with inbox check message and resend button. All forms have client-side validation, loading states, and error handling.
  </done>
</task>

</tasks>

<verification>
- All auth page routes accessible: /login, /register, /forgot-password, /reset-password, /verify-email
- Split-screen layout renders correctly (branding left, form right on desktop; form only on mobile)
- Social login buttons visible below email/password form on login page
- Form validation shows inline errors for invalid input
- Navigation links between auth pages work (login <-> register, login -> forgot-password)
- `bun run build` passes
</verification>

<success_criteria>
- Login page at /login with email/password form, Google/GitHub OAuth buttons, forgot password link, and register link
- Register page at /register with name, email, password, ToS checkbox, and login link
- Forgot password page at /forgot-password with email input and back-to-login link
- Reset password page at /reset-password with new password + confirm password fields
- Verify email page at /verify-email with "check your inbox" message and resend button
- All pages use split-screen layout with branding panel (desktop) and responsive form
- All forms validate with zod schemas and show field-level + server-level errors
- OAuth buttons call signIn.social with callbackURL parameter
- Loading states shown during all auth operations
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication-app-shell/02-02-SUMMARY.md`
</output>
