---
phase: 01-foundation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - bun.lock
  - tsconfig.json
  - next.config.ts
  - postcss.config.mjs
  - biome.json
  - vitest.config.mts
  - components.json
  - src/app/styles/globals.css
  - src/shared/lib/cn.ts
  - src/shared/lib/env.ts
  - src/test-setup.ts
  - app/layout.tsx
  - app/page.tsx
  - app/(dashboard)/layout.tsx
  - .storybook/main.ts
  - .storybook/preview.ts
autonomous: true
requirements:
  - INFR-01
  - INFR-08

must_haves:
  truths:
    - "Running `bun run dev` starts the Next.js 16 dev server with Turbopack on port 3000"
    - "Running `bun run lint` executes Biome linting with zero errors on the scaffolded code"
    - "Running `bun run test` executes Vitest and passes (at least a placeholder test)"
    - "The Tailwind v4 OKLCH theme renders correct colors in both light and dark modes"
    - "The FSD directory structure exists with app/, src/app/, src/pages/, src/widgets/, src/features/, src/entities/, src/shared/ layers"
    - "Storybook starts and renders a placeholder story with correct Tailwind styles"
  artifacts:
    - path: "package.json"
      provides: "All Phase 1 dependencies installed"
      contains: "next"
    - path: "tsconfig.json"
      provides: "Strict TypeScript configuration with path aliases"
      contains: "strict"
    - path: "next.config.ts"
      provides: "Next.js 16 configuration"
      contains: "nextConfig"
    - path: "biome.json"
      provides: "Biome linting and formatting config"
      contains: "linter"
    - path: "src/app/styles/globals.css"
      provides: "Tailwind v4 CSS-first theme with OKLCH color tokens"
      contains: "@import"
    - path: "src/shared/lib/cn.ts"
      provides: "Tailwind class merging utility"
      exports: ["cn"]
    - path: "src/shared/lib/env.ts"
      provides: "Validated environment variables"
      exports: ["env"]
    - path: "app/layout.tsx"
      provides: "Root layout with providers, fonts, theme"
      contains: "RootLayout"
  key_links:
    - from: "app/layout.tsx"
      to: "src/app/styles/globals.css"
      via: "CSS import"
      pattern: "import.*globals\\.css"
    - from: "app/layout.tsx"
      to: "src/app/providers/app-providers.tsx"
      via: "Provider wrapper"
      pattern: "AppProviders"
    - from: "src/shared/lib/cn.ts"
      to: "clsx + tailwind-merge"
      via: "re-export utility"
      pattern: "twMerge.*clsx"
---

<objective>
Scaffold the Next.js 16 project with all core dependencies, Tailwind CSS v4 OKLCH theme, shadcn/ui, Biome, Vitest, Storybook, and the Feature-Sliced Design directory structure.

Purpose: This is the foundation every other plan builds on. Without the project structure, theme, and tooling in place, no other work can begin.
Output: A running Next.js 16 dev server with the full design system tokens, FSD directory layout, and all development tooling configured.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js 16 project with all dependencies, TypeScript strict mode, and tooling configs</name>
  <files>
    package.json
    bun.lock
    tsconfig.json
    next.config.ts
    postcss.config.mjs
    biome.json
    vitest.config.mts
    components.json
    .env.example
    .env.local
    .gitignore
    src/test-setup.ts
  </files>
  <action>
    1. Initialize the Next.js 16 project using `bunx create-next-app@latest . --typescript --tailwind --app --src-dir=no --import-alias="@/*" --turbopack --use-bun` (use `--yes` or similar flags to skip prompts). If create-next-app wants a clean directory, move .planning and .git aside, scaffold, then move them back. Adjust the output: the app/ dir stays at root for routing, but we will move source code into src/ per FSD.

    2. Install ALL Phase 1 dependencies in one go (see RESEARCH.md Standard Stack for exact versions):
       ```bash
       # Core (already from create-next-app): next, react, react-dom, typescript, tailwindcss
       bun add drizzle-orm pg ioredis bullmq zustand @tanstack/react-query nuqs zod @t3-oss/env-nextjs class-variance-authority clsx tailwind-merge lucide-react next-themes sonner @tanstack/react-table @tanstack/react-virtual date-fns nanoid pino ws
       bun add -D @types/react @types/react-dom @types/pg @types/ws drizzle-kit @biomejs/biome vitest @vitejs/plugin-react vite-tsconfig-paths jsdom @testing-library/react pino-pretty knip
       ```

    3. Configure `tsconfig.json` with strict mode:
       - `"strict": true`
       - `"noUncheckedIndexedAccess": true`
       - `"exactOptionalPropertyTypes": true`
       - Path alias: `"@/*": ["./src/*"]`
       - Include: `["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"]`

    4. Configure `next.config.ts`:
       - Enable standalone output for Docker: `output: 'standalone'`
       - Configure `serverExternalPackages: ['pino', 'pino-pretty', 'bullmq']`

    5. Configure `postcss.config.mjs`:
       ```js
       export default { plugins: { '@tailwindcss/postcss': {} } };
       ```

    6. Configure `biome.json` per RESEARCH.md pattern:
       - Linter enabled with recommended rules
       - Formatter: tab indentation, 100 line width
       - Import sorting enabled
       - Include TS/TSX/JS/JSON/CSS files
       - Ignore: node_modules, .next, drizzle (generated migrations)

    7. Configure `vitest.config.mts` per RESEARCH.md pattern:
       - jsdom environment, React plugin, tsconfig paths
       - Setup file at `src/test-setup.ts`
       - Include pattern: `src/**/*.test.{ts,tsx}`

    8. Create `src/test-setup.ts` with `@testing-library/jest-dom` import (or empty if not using jest-dom yet).

    9. Initialize shadcn/ui: `bunx shadcn@latest init` -- select New York style, configure `components.json` to point to `src/shared/ui` as the components directory and `src/shared/lib/cn.ts` for the utils path. Use the existing Tailwind CSS file.

    10. Create `.env.example` with all required env vars:
        ```
        DATABASE_URL=postgres://axion:axion@localhost:5432/axion
        REDIS_URL=redis://localhost:6379
        GATEWAY_URL=ws://127.0.0.1:18789
        GATEWAY_TOKEN=
        AXION_MODE=local
        ```
        Create `.env.local` as a copy for local development.

    11. Add scripts to `package.json`:
        ```json
        "scripts": {
          "dev": "next dev --turbopack",
          "build": "next build",
          "start": "next start",
          "lint": "biome check .",
          "lint:fix": "biome check --write .",
          "format": "biome format --write .",
          "test": "vitest run",
          "test:watch": "vitest",
          "db:generate": "drizzle-kit generate",
          "db:migrate": "drizzle-kit migrate",
          "storybook": "storybook dev -p 6006",
          "build-storybook": "storybook build"
        }
        ```

    12. Update `.gitignore` to include: `.env.local`, `.next/`, `node_modules/`, `drizzle/meta/`, `storybook-static/`, `*.tsbuildinfo`.

    IMPORTANT: Next.js 16 uses Turbopack by default. Do NOT create `tailwind.config.js` -- Tailwind v4 is CSS-first. Do NOT create `middleware.ts` -- deprecated in Next.js 16, use `proxy.ts` if needed later.
  </action>
  <verify>
    - `bun run lint` exits with code 0 (no lint errors)
    - `bun run test` exits with code 0 (placeholder test passes)
    - `bun run build` completes without errors
    - `cat tsconfig.json | grep '"strict": true'` confirms strict mode
    - `cat biome.json | grep '"enabled": true'` confirms linter enabled
    - `ls src/shared/lib/cn.ts` confirms shadcn utility exists
  </verify>
  <done>
    Next.js 16 project builds and passes lint. All Phase 1 dependencies installed. TypeScript strict mode enabled. Biome, Vitest, and shadcn/ui configured. Environment validation set up.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FSD directory structure, OKLCH theme, root layout with providers, and Storybook</name>
  <files>
    src/app/providers/app-providers.tsx
    src/app/providers/query-provider.tsx
    src/app/providers/theme-provider.tsx
    src/app/styles/globals.css
    src/pages/.gitkeep
    src/widgets/.gitkeep
    src/features/.gitkeep
    src/entities/.gitkeep
    src/shared/ui/.gitkeep
    src/shared/lib/cn.ts
    src/shared/lib/env.ts
    src/shared/config/.gitkeep
    src/shared/types/.gitkeep
    app/layout.tsx
    app/page.tsx
    app/(dashboard)/layout.tsx
    .storybook/main.ts
    .storybook/preview.ts
  </files>
  <action>
    1. Create the complete FSD directory tree:
       ```
       src/
         app/providers/         # App-level providers
         app/styles/            # Global styles
         pages/                 # FSD page compositions
         widgets/               # Composed UI blocks
         features/              # Domain feature modules
         entities/              # Business entities
         shared/ui/             # shadcn + custom components
         shared/lib/            # Pure utilities
         shared/config/         # Constants, feature flags
         shared/types/          # Global shared types
       ```
       Use `.gitkeep` files in empty directories to preserve structure in git.

    2. Create `src/app/styles/globals.css` with the full Tailwind v4 OKLCH theme.
       CRITICAL: Use CSS-first configuration. No tailwind.config.js.
       ```css
       @import "tailwindcss";

       /* Light theme */
       :root {
         --background: oklch(0.9846 0.0020 308.19);
         --foreground: oklch(0.1797 0.0043 308.19);
         --card: oklch(0.9846 0.0020 308.19);
         --card-foreground: oklch(0.1797 0.0043 308.19);
         --popover: oklch(0.9846 0.0020 308.19);
         --popover-foreground: oklch(0.1797 0.0043 308.19);
         --primary: oklch(0.5424 0.1337 49.98);
         --primary-foreground: oklch(0.9846 0.0020 308.19);
         --secondary: oklch(0.4940 0.0443 196.02);
         --secondary-foreground: oklch(0.9846 0.0020 308.19);
         --muted: oklch(0.9279 0.0063 308.19);
         --muted-foreground: oklch(0.4522 0.0085 308.19);
         --accent: oklch(0.9279 0.0063 308.19);
         --accent-foreground: oklch(0.1797 0.0043 308.19);
         --destructive: oklch(0.5772 0.2152 27.33);
         --destructive-foreground: oklch(0.9846 0.0020 308.19);
         --border: oklch(0.8696 0.0106 308.19);
         --input: oklch(0.8696 0.0106 308.19);
         --ring: oklch(0.5424 0.1337 49.98);
         --radius: 0.75rem;
         --success: oklch(0.5500 0.1500 155.00);
         --success-foreground: oklch(0.9846 0.0020 308.19);
         --warning: oklch(0.7214 0.1337 49.98);
         --warning-foreground: oklch(0.1797 0.0043 308.19);
       }

       /* Dark theme */
       .dark {
         --background: oklch(0.1797 0.0043 308.19);
         --foreground: oklch(0.9846 0.0020 308.19);
         --card: oklch(0.2160 0.0052 308.19);
         --card-foreground: oklch(0.9846 0.0020 308.19);
         --popover: oklch(0.2160 0.0052 308.19);
         --popover-foreground: oklch(0.9846 0.0020 308.19);
         --primary: oklch(0.7214 0.1337 49.98);
         --primary-foreground: oklch(0.1797 0.0043 308.19);
         --secondary: oklch(0.5940 0.0443 196.02);
         --secondary-foreground: oklch(0.9846 0.0020 308.19);
         --muted: oklch(0.2797 0.0043 308.19);
         --muted-foreground: oklch(0.6522 0.0085 308.19);
         --accent: oklch(0.2797 0.0043 308.19);
         --accent-foreground: oklch(0.9846 0.0020 308.19);
         --destructive: oklch(0.5772 0.2152 27.33);
         --destructive-foreground: oklch(0.9846 0.0020 308.19);
         --border: oklch(0.3279 0.0063 308.19);
         --input: oklch(0.3279 0.0063 308.19);
         --ring: oklch(0.7214 0.1337 49.98);
         --success: oklch(0.5940 0.0443 196.02);
         --success-foreground: oklch(0.9846 0.0020 308.19);
         --warning: oklch(0.7214 0.1337 49.98);
         --warning-foreground: oklch(0.1797 0.0043 308.19);
       }

       @theme inline {
         --color-background: var(--background);
         --color-foreground: var(--foreground);
         --color-card: var(--card);
         --color-card-foreground: var(--card-foreground);
         --color-popover: var(--popover);
         --color-popover-foreground: var(--popover-foreground);
         --color-primary: var(--primary);
         --color-primary-foreground: var(--primary-foreground);
         --color-secondary: var(--secondary);
         --color-secondary-foreground: var(--secondary-foreground);
         --color-muted: var(--muted);
         --color-muted-foreground: var(--muted-foreground);
         --color-accent: var(--accent);
         --color-accent-foreground: var(--accent-foreground);
         --color-destructive: var(--destructive);
         --color-destructive-foreground: var(--destructive-foreground);
         --color-border: var(--border);
         --color-input: var(--input);
         --color-ring: var(--ring);
         --color-success: var(--success);
         --color-success-foreground: var(--success-foreground);
         --color-warning: var(--warning);
         --color-warning-foreground: var(--warning-foreground);
         --radius-sm: calc(var(--radius) - 0.25rem);
         --radius-md: calc(var(--radius) - 0.125rem);
         --radius-lg: var(--radius);
         --radius-xl: calc(var(--radius) + 0.25rem);
         --font-sans: 'Outfit', ui-sans-serif, system-ui, sans-serif;
         --font-mono: 'JetBrains Mono', ui-monospace, monospace;
         --font-serif: 'Merriweather', ui-serif, Georgia, serif;
       }

       /* Skeleton shimmer animation */
       @keyframes shimmer {
         0% { background-position: -200% 0; }
         100% { background-position: 200% 0; }
       }

       /* Storybook + Tailwind v4 source scanning */
       @source "../src";
       @source "../app";
       ```
       NOTE: Adjust OKLCH values if the user has a pre-existing complete theme file -- use those exact values. The values above are derived from CONTEXT.md decision colors. Add/adjust tokens as needed for shadcn/ui compatibility.

    3. Create `src/shared/lib/env.ts` using `@t3-oss/env-nextjs`:
       ```typescript
       import { createEnv } from '@t3-oss/env-nextjs';
       import { z } from 'zod';

       export const env = createEnv({
         server: {
           DATABASE_URL: z.string().url(),
           REDIS_URL: z.string().url(),
           GATEWAY_URL: z.string().url().optional(),
           GATEWAY_TOKEN: z.string().optional(),
           AXION_MODE: z.enum(['local', 'remote']).default('local'),
         },
         client: {},
         runtimeEnv: {
           DATABASE_URL: process.env.DATABASE_URL,
           REDIS_URL: process.env.REDIS_URL,
           GATEWAY_URL: process.env.GATEWAY_URL,
           GATEWAY_TOKEN: process.env.GATEWAY_TOKEN,
           AXION_MODE: process.env.AXION_MODE,
         },
       });
       ```

    4. Create `src/app/providers/theme-provider.tsx` (client component):
       - Uses `next-themes` ThemeProvider with `attribute="class"`, `defaultTheme="system"`, `enableSystem`, `disableTransitionOnChange`.

    5. Create `src/app/providers/query-provider.tsx` (client component):
       - Creates QueryClient with `staleTime: 60_000`, `refetchOnWindowFocus: false`.
       - Uses `useState` pattern per RESEARCH.md to avoid SSR hydration issues.

    6. Create `src/app/providers/app-providers.tsx` (client component):
       - Composes ThemeProvider and QueryProvider around children.
       - Import and add Toaster from `sonner`.

    7. Create `app/layout.tsx` (root layout):
       - Import globals.css from `@/app/styles/globals.css`.
       - Load Outfit, JetBrains Mono, and Merriweather fonts via `next/font/google`.
       - Wrap children in `<AppProviders>`.
       - Set `<html>` with `suppressHydrationWarning` (required by next-themes).
       - Add appropriate `<body>` classes: `font-sans antialiased bg-background text-foreground`.

    8. Create `app/page.tsx` as a minimal placeholder page showing "AXion Hub" with the primary color, confirming the theme works.

    9. Create `app/(dashboard)/layout.tsx` as a placeholder dashboard layout shell (just passes through children for now -- sidebar/topbar comes in Phase 2).

    10. Set up Storybook:
        - Run `bunx storybook@latest init --builder @storybook/builder-vite --type react` (or configure manually).
        - Configure `.storybook/main.ts` with `@storybook/nextjs` framework, TS/TSX stories, addons (essentials, themes).
        - Configure `.storybook/preview.ts` to import `../src/app/styles/globals.css` for Tailwind styles and set dark mode as default background.

    IMPORTANT per user decisions:
    - Typography: Outfit (sans), JetBrains Mono (mono), Merriweather (serif) -- non-negotiable
    - Border radius: 0.75rem -- already in CSS as --radius
    - Theme: System-aware with class attribute for Tailwind dark mode
    - Aesthetic: Dark, sleek, techy -- default to dark mode in Storybook
  </action>
  <verify>
    - `bun run dev` starts without errors and visiting localhost:3000 shows the placeholder page with correct fonts and colors
    - `ls src/app/providers/` shows theme-provider.tsx, query-provider.tsx, app-providers.tsx
    - `ls src/shared/lib/` shows cn.ts, env.ts
    - `ls src/pages src/widgets src/features src/entities src/shared/ui src/shared/config src/shared/types` all exist
    - `bun run storybook` starts on port 6006 and shows styled content
    - Dark mode toggle works (theme switches via next-themes)
  </verify>
  <done>
    FSD directory structure created. OKLCH theme renders in both light and dark modes. Root layout loads all three font families. App providers compose theme, query, and toast providers. Storybook starts with Tailwind styles applied. The project is ready for feature development.
  </done>
</task>

</tasks>

<verification>
1. `bun run dev` starts Next.js 16 dev server on port 3000 without errors
2. `bun run build` completes successfully
3. `bun run lint` passes with zero errors
4. `bun run test` passes (placeholder test)
5. `bun run storybook` starts on port 6006 with Tailwind styles
6. Visiting localhost:3000 shows styled page with correct OKLCH colors and fonts
7. FSD directory structure exists at expected paths
8. TypeScript strict mode catches type errors at build time
</verification>

<success_criteria>
- Next.js 16 project runs with Turbopack, builds for production, passes Biome linting
- All Phase 1 dependencies installed and importable
- Tailwind v4 OKLCH theme renders correctly in light and dark modes
- FSD directory structure (app/, src/app/, src/pages/, src/widgets/, src/features/, src/entities/, src/shared/) exists
- Vitest runs with jsdom environment
- Storybook starts and applies Tailwind styles
- Environment variables validated via @t3-oss/env-nextjs
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md`
</output>
