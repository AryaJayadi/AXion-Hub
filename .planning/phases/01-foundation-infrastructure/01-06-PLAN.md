---
phase: 01-foundation-infrastructure
plan: 06
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/shared/ui/data-table.tsx
  - src/shared/ui/status-badge.tsx
  - src/shared/ui/form-field.tsx
  - src/shared/ui/page-header.tsx
  - src/shared/ui/empty-state.tsx
  - src/shared/ui/loading-skeleton.tsx
  - src/shared/ui/action-menu.tsx
  - src/shared/ui/filter-bar.tsx
  - src/shared/ui/error-boundary.tsx
  - src/shared/ui/search-input.tsx
autonomous: true
requirements:
  - INFR-07

must_haves:
  truths:
    - "DataTable renders tabular data with sorting, filtering, pagination, and virtual scrolling for large datasets"
    - "StatusBadge displays semantic status (online, idle, working, error, offline) with theme-tinted OKLCH colors"
    - "EmptyState shows an illustration with helpful copy and a CTA button"
    - "LoadingSkeleton renders shimmer-animated placeholders that mirror target layout shapes"
    - "All components render correctly in Storybook with dark mode"
    - "ErrorBoundary catches React errors and displays a fallback UI instead of crashing"
  artifacts:
    - path: "src/shared/ui/data-table.tsx"
      provides: "Virtual-scrolling data table with TanStack Table"
      exports: ["DataTable"]
      min_lines: 80
    - path: "src/shared/ui/status-badge.tsx"
      provides: "Theme-tinted semantic status badges"
      exports: ["StatusBadge"]
    - path: "src/shared/ui/form-field.tsx"
      provides: "Form field wrapper with label, error, description"
      exports: ["FormField"]
    - path: "src/shared/ui/page-header.tsx"
      provides: "Consistent page header with title, description, actions"
      exports: ["PageHeader"]
    - path: "src/shared/ui/empty-state.tsx"
      provides: "Illustrated empty states with CTA"
      exports: ["EmptyState"]
    - path: "src/shared/ui/loading-skeleton.tsx"
      provides: "Shimmer skeleton screens"
      exports: ["LoadingSkeleton", "SkeletonTable", "SkeletonCard", "SkeletonList"]
    - path: "src/shared/ui/action-menu.tsx"
      provides: "Dropdown action menus"
      exports: ["ActionMenu"]
    - path: "src/shared/ui/filter-bar.tsx"
      provides: "Filter and search bar"
      exports: ["FilterBar"]
    - path: "src/shared/ui/error-boundary.tsx"
      provides: "Error boundary with fallback"
      exports: ["ErrorBoundary"]
    - path: "src/shared/ui/search-input.tsx"
      provides: "Debounced search input"
      exports: ["SearchInput"]
  key_links:
    - from: "src/shared/ui/data-table.tsx"
      to: "@tanstack/react-table"
      via: "headless table logic"
      pattern: "useReactTable"
    - from: "src/shared/ui/data-table.tsx"
      to: "@tanstack/react-virtual"
      via: "virtual scrolling"
      pattern: "useVirtualizer"
    - from: "src/shared/ui/loading-skeleton.tsx"
      to: "src/app/styles/globals.css"
      via: "shimmer keyframe animation"
      pattern: "shimmer|animate"
    - from: "src/shared/ui/status-badge.tsx"
      to: "class-variance-authority"
      via: "variant definitions"
      pattern: "cva"
---

<objective>
Build the shared UI component library with DataTable (virtual scrolling), StatusBadge, FormField, PageHeader, EmptyState, LoadingSkeleton, ActionMenu, FilterBar, ErrorBoundary, and SearchInput -- all built on shadcn/ui primitives and the OKLCH design system.

Purpose: These 10 components are used across all 87 pages. Building them now with correct styling, behavior defaults, and Storybook stories ensures visual consistency and prevents per-page re-implementation.
Output: A complete shared component library with Storybook stories, ready for use in Phase 2+.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-RESEARCH.md
@.planning/phases/01-foundation-infrastructure/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui base components and build DataTable, StatusBadge, LoadingSkeleton, and EmptyState</name>
  <files>
    src/shared/ui/data-table.tsx
    src/shared/ui/status-badge.tsx
    src/shared/ui/loading-skeleton.tsx
    src/shared/ui/empty-state.tsx
  </files>
  <action>
    1. First, install required shadcn/ui primitives that the custom components build on:
       ```bash
       bunx shadcn@latest add table badge skeleton dropdown-menu input button card separator
       ```
       This copies the shadcn/ui components into `src/shared/ui/` (as configured in components.json).

    2. Create `src/shared/ui/data-table.tsx`:
       - Generic component: `DataTable<TData, TValue>`
       - Uses `useReactTable` from `@tanstack/react-table` with:
         - Column definitions (passed as prop)
         - Sorting state (client-side)
         - Filtering (global and column-level)
         - Pagination (client-side, configurable page size)
         - Column visibility toggling
         - Row selection (optional, via checkbox column)
       - Integrates `@tanstack/react-virtual` `useVirtualizer` for virtual scrolling:
         - Virtualize rows when dataset > 50 rows
         - Fixed row height estimation for performance
         - Smooth scrolling container with ref
       - Built on shadcn/ui `<Table>` component for consistent styling
       - Props interface:
         ```typescript
         interface DataTableProps<TData, TValue> {
           columns: ColumnDef<TData, TValue>[];
           data: TData[];
           searchKey?: string;           // Column key for global search
           searchPlaceholder?: string;
           enableVirtualization?: boolean; // default: auto (true if data.length > 50)
           enablePagination?: boolean;     // default: true
           pageSize?: number;             // default: 25
           enableRowSelection?: boolean;
           onRowSelectionChange?: (rows: TData[]) => void;
           emptyState?: ReactNode;        // Custom empty state
           isLoading?: boolean;           // Show skeleton when true
         }
         ```
       - When `isLoading` is true, render `<SkeletonTable>` in place of data
       - When data is empty and not loading, render the `emptyState` prop or a default `<EmptyState>`
       - Per user decision: Virtual scrolling for large datasets, smooth infinite scroll

    3. Create `src/shared/ui/status-badge.tsx`:
       - Uses `class-variance-authority` (cva) for variant definitions
       - Status variants mapping to theme-tinted colors (per user decision):
         - `online` / `connected` / `active`: teal-green (uses --success or --secondary tinted)
         - `idle` / `standby`: muted with secondary tint
         - `working` / `running` / `in-progress`: primary amber/orange with pulse animation
         - `error` / `failed` / `offline`: destructive red
         - `warning` / `degraded`: warning amber
         - `unknown` / `pending`: muted neutral
       - Props: `status: string`, `label?: string` (defaults to capitalized status), `size?: 'sm' | 'md' | 'lg'`, `showDot?: boolean` (animated dot indicator)
       - The dot for `working` status should have a subtle pulse animation
       - Per user decision: Semantic colors tinted toward the OKLCH palette

    4. Create `src/shared/ui/loading-skeleton.tsx`:
       - Base `<LoadingSkeleton>` component using shadcn/ui `<Skeleton>` with shimmer animation
       - The shimmer animation is defined in globals.css (already added in 01-01)
       - Preset composites for common layouts:
         - `<SkeletonTable rows={5} columns={4}>` -- table with header and body placeholders
         - `<SkeletonCard>` -- card with title, description, and action placeholders
         - `<SkeletonList items={3}>` -- list items with avatar and text placeholders
         - `<SkeletonDetail>` -- detail page with header, sections, and sidebar
       - Each skeleton shape should mirror the layout it represents (per user decision: "Placeholder shapes mirror the layout about to appear")
       - Animation: Apply the shimmer class from globals.css. Use Tailwind's `animate-pulse` as fallback.

    5. Create `src/shared/ui/empty-state.tsx`:
       - Props: `icon?: ReactNode` (SVG illustration or Lucide icon), `title: string`, `description: string`, `action?: { label: string; onClick: () => void }` (CTA button), `className?: string`
       - Layout: Centered vertically, icon at top (64x64), title below (text-lg font-semibold), description (text-muted-foreground), CTA button at bottom
       - Per user decision: Illustrated + helpful, friendly copy, clear CTA ("No agents yet -- create your first one")
       - Illustration style (Claude's discretion): Line art SVG with primary amber accent color, simple geometric shapes. Professional and minimal -- mission control feel, not cute.
       - Include a default illustration component for when no icon is provided

    6. Create Storybook stories for each component:
       - `src/shared/ui/data-table.stories.tsx` -- with mock data, sorting demo, virtual scrolling demo (100+ rows)
       - `src/shared/ui/status-badge.stories.tsx` -- all status variants in a grid
       - `src/shared/ui/loading-skeleton.stories.tsx` -- all preset shapes
       - `src/shared/ui/empty-state.stories.tsx` -- with and without CTA, custom icons
  </action>
  <verify>
    - `bun run storybook` starts and all 4 component stories render
    - DataTable renders mock data with sorting (click column header to sort)
    - DataTable virtual scrolling works with 100+ row dataset
    - StatusBadge shows all variants with correct colors
    - LoadingSkeleton shimmer animation is visible
    - EmptyState renders with illustration, title, description, and CTA button
    - All components respect dark mode (switch theme in Storybook)
  </verify>
  <done>
    DataTable, StatusBadge, LoadingSkeleton, and EmptyState components built with correct behavior defaults, Storybook stories, and OKLCH theme integration. Virtual scrolling activates for large datasets. Status colors are theme-tinted. Skeletons shimmer. Empty states have illustrations and CTAs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build PageHeader, FormField, ActionMenu, FilterBar, ErrorBoundary, and SearchInput</name>
  <files>
    src/shared/ui/page-header.tsx
    src/shared/ui/form-field.tsx
    src/shared/ui/action-menu.tsx
    src/shared/ui/filter-bar.tsx
    src/shared/ui/error-boundary.tsx
    src/shared/ui/search-input.tsx
  </files>
  <action>
    1. Create `src/shared/ui/page-header.tsx`:
       - Props: `title: string`, `description?: string`, `actions?: ReactNode` (right-aligned buttons), `breadcrumbs?: Array<{ label: string; href?: string }>`, `className?: string`
       - Layout: Flex row, title + description on left, actions on right. Breadcrumbs above title if provided.
       - Responsive: Actions wrap below title on mobile
       - Comfortable density: generous padding-bottom, clear visual separation from page content

    2. Create `src/shared/ui/form-field.tsx`:
       - Wrapper component for form inputs with consistent layout:
         - `label: string`, `description?: string`, `error?: string`, `required?: boolean`, `children: ReactNode` (the actual input)
       - Label with optional red asterisk for required
       - Description text below label in muted foreground
       - Error text below input in destructive color with fade-in animation
       - Connects label to input via `htmlFor` / `id` pairing
       - This is a layout wrapper, NOT a form library integration. It works with any input element.

    3. Create `src/shared/ui/action-menu.tsx`:
       - Built on shadcn/ui `<DropdownMenu>`
       - Props: `trigger?: ReactNode` (defaults to three-dot icon), `items: ActionMenuItem[]`
       - `ActionMenuItem` type:
         ```typescript
         type ActionMenuItem = {
           label: string;
           icon?: ReactNode;
           onClick: () => void;
           variant?: 'default' | 'destructive';
           disabled?: boolean;
         } | { type: 'separator' };
         ```
       - Renders a dropdown with icon + label items, separator support, destructive variant (red text)
       - Trigger default: `<MoreHorizontal>` icon from lucide-react in a ghost button

    4. Create `src/shared/ui/filter-bar.tsx`:
       - Props: `filters: FilterConfig[]`, `values: Record<string, unknown>`, `onChange: (key: string, value: unknown) => void`, `onClear: () => void`
       - `FilterConfig` type:
         ```typescript
         type FilterConfig = {
           key: string;
           label: string;
           type: 'select' | 'multi-select' | 'date-range' | 'text';
           options?: Array<{ label: string; value: string }>;
         };
         ```
       - Renders a horizontal bar with filter controls. Select filters use shadcn Select/Popover. Active filters show as removable badges.
       - "Clear all" button when any filters are active
       - Responsive: wraps to multiple rows on mobile

    5. Create `src/shared/ui/error-boundary.tsx`:
       - React class component (error boundaries must be class components)
       - Catches errors in child tree and renders fallback UI
       - Fallback shows: error icon, "Something went wrong" title, error message (in dev mode), "Try again" button that resets the boundary
       - Props: `fallback?: ReactNode` (custom fallback), `onError?: (error: Error, errorInfo: ErrorInfo) => void` (error reporting callback)
       - Export a functional wrapper `withErrorBoundary(Component)` HOC for convenience

    6. Create `src/shared/ui/search-input.tsx`:
       - Props: `value: string`, `onChange: (value: string) => void`, `placeholder?: string`, `debounceMs?: number` (default: 300), `className?: string`
       - Built on shadcn `<Input>` with a search icon (lucide `<Search>`) prefix
       - Debounced onChange: uses `useEffect` + `setTimeout` pattern (no external deps needed for this)
       - Clear button (X icon) appears when input has value
       - Accessible: proper ARIA labels, keyboard support

    7. Create Storybook stories for all 6 components:
       - `page-header.stories.tsx` -- with breadcrumbs, with/without actions
       - `form-field.stories.tsx` -- normal, with error, with description, required
       - `action-menu.stories.tsx` -- with various items, destructive item, disabled item
       - `filter-bar.stories.tsx` -- with select and text filters, active filters
       - `error-boundary.stories.tsx` -- with a component that throws an error
       - `search-input.stories.tsx` -- typing with debounce, clear button

    IMPORTANT per user decisions:
    - Comfortable density: generous padding, breathing room between elements
    - Dark, sleek, techy aesthetic: use muted backgrounds, subtle borders, clean typography
    - All components must work in both light and dark modes
  </action>
  <verify>
    - `bun run storybook` shows all 10 component stories (4 from Task 1 + 6 from Task 2)
    - PageHeader renders title, description, breadcrumbs, and right-aligned actions
    - FormField shows label, description, and error states
    - ActionMenu opens dropdown with items, separators, and destructive variant
    - FilterBar renders filter controls with active filter badges
    - ErrorBoundary catches thrown errors and shows fallback UI
    - SearchInput debounces input and shows clear button
    - All components render correctly in dark mode
    - `bun run build` compiles all components without errors
  </verify>
  <done>
    All 10 shared UI components built and storied: DataTable, StatusBadge, FormField, PageHeader, EmptyState, LoadingSkeleton, ActionMenu, FilterBar, ErrorBoundary, SearchInput. Each has Storybook stories demonstrating all variants and states. Components follow the OKLCH theme, comfortable density, and dark/sleek aesthetic. The component library is ready for page development in Phase 2+.
  </done>
</task>

</tasks>

<verification>
1. `bun run storybook` starts and shows all 10 component stories
2. Each component renders correctly in both light and dark modes
3. DataTable virtual scrolling works with 100+ rows
4. StatusBadge shows all semantic status variants with correct colors
5. EmptyState shows illustration, title, description, CTA
6. LoadingSkeleton shimmer animation is visible and smooth
7. ErrorBoundary catches errors and shows recovery UI
8. SearchInput debounces input correctly
9. `bun run build` compiles all components without TypeScript errors
10. No console warnings or errors in Storybook
</verification>

<success_criteria>
- All 10 components exported from src/shared/ui/
- Storybook stories demonstrate every component variant and state
- DataTable supports sorting, filtering, pagination, virtual scrolling, loading state, empty state
- StatusBadge uses theme-tinted semantic colors with optional animated dot
- EmptyState has illustration (line art SVG), title, description, CTA
- LoadingSkeleton presets (table, card, list, detail) with shimmer animation
- All components respect the OKLCH theme and comfortable density
- Components are tree-shakeable (individual imports work)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-06-SUMMARY.md`
</output>
