---
phase: 08-sessions-memory-files-governance
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/features/workspace/api/use-deliverables.ts
  - src/features/workspace/api/use-file-upload.ts
  - src/features/workspace/components/deliverables-table.tsx
  - src/features/workspace/components/upload-dialog.tsx
  - src/views/workspace/deliverables-view.tsx
  - src/views/workspace/upload-view.tsx
  - app/(dashboard)/deliverables/page.tsx
  - app/(dashboard)/workspace/upload/page.tsx
autonomous: true
requirements:
  - FILE-03
  - FILE-04

must_haves:
  truths:
    - "User can view all task deliverables at /deliverables grouped by task"
    - "Deliverables link back to their parent task"
    - "User can filter deliverables by task status and agent"
    - "User can upload files at /workspace/upload to shared workspace or per-agent directories"
    - "Upload supports drag-and-drop zone with target selection"
  artifacts:
    - path: "src/features/workspace/components/deliverables-table.tsx"
      provides: "Task-grouped deliverables DataTable"
      contains: "DeliverablesTable"
    - path: "src/features/workspace/components/upload-dialog.tsx"
      provides: "Upload dialog with drag-and-drop and target selector"
      contains: "UploadDialog"
    - path: "src/views/workspace/deliverables-view.tsx"
      provides: "Deliverables page composition"
      contains: "DeliverablesView"
  key_links:
    - from: "app/(dashboard)/deliverables/page.tsx"
      to: "src/views/workspace/deliverables-view.tsx"
      via: "Next.js route -> view component"
      pattern: "DeliverablesView"
    - from: "src/features/workspace/components/deliverables-table.tsx"
      to: "src/features/workspace/api/use-deliverables.ts"
      via: "TanStack Query hook"
      pattern: "useDeliverables"
---

<objective>
Build the deliverables listing and file upload experiences: a task-grouped deliverables table with filtering and a drag-and-drop file upload page with workspace target selection.

Purpose: Users need to see all deliverables produced by agents across tasks in one place (linked back to the mission board), and upload files to agent workspaces for agents to work with.

Output: 2 TanStack Query hooks with mock data, 2 feature components, 2 view compositions, 2 route pages.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/features/missions/components/task-deliverables.tsx (DeliverablePreviewCard pattern from Phase 6)
@src/features/chat/components/media-upload-zone.tsx (drag-and-drop upload pattern from Phase 4)
@src/entities/mission/model/types.ts (Deliverable type)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deliverables table grouped by task with filtering at /deliverables</name>
  <files>
    src/features/workspace/api/use-deliverables.ts
    src/features/workspace/components/deliverables-table.tsx
    src/views/workspace/deliverables-view.tsx
    app/(dashboard)/deliverables/page.tsx
  </files>
  <action>
    **use-deliverables.ts**: TanStack Query hook returning deliverables data. Define a local type TaskDeliverable extending the existing Deliverable type (from @/entities/mission) with: taskId (string), taskTitle (string), taskStatus (string), agentId (string), agentName (string).
    - Generate 12-15 mock deliverables across 4-5 tasks:
      - "Research Summary" task by Research Agent: 2 deliverables (report.md, sources.json)
      - "Data Pipeline" task by Data Agent: 3 deliverables (pipeline.py, output.csv, logs.txt)
      - "Feature Implementation" task by Code Agent: 2 deliverables (component.tsx, test.ts)
      - "Content Draft" task by Writer Agent: 2 deliverables (draft.md, images/)
      - "API Integration" task by Code Agent: 2 deliverables (client.ts, types.ts)
    - Include varied task statuses: done, in_review, in_progress.
    - Support filters param: { taskStatus?: string, agentId?: string }.
    - staleTime: Infinity. Use queryKeys.deliverables.list(filters).

    **deliverables-table.tsx**: DeliverablesTable component.
    - Takes TaskDeliverable[] as prop.
    - Group deliverables by taskId. Render each group as a section:
      - Group header: task title as link to /missions/{taskId}, task status badge (StatusBadge), agent name, deliverable count.
      - Under each group: grid of deliverable cards. Reuse the DeliverablePreviewCard rendering pattern from Phase 6 (type-based rendering: file shows icon+name+size, code shows snippet preview, link shows URL). If importing the actual component is feasible, do so. Otherwise recreate the card pattern with same visual design.
    - If no deliverables: EmptyState "No deliverables found".
    - nuqs useQueryState for filters: `status` (task status filter) and `agent` (agent filter).
    - FilterBar at top with: task status Select (all, done, in_review, in_progress), agent Select (all agents list).

    **deliverables-view.tsx**: DeliverablesView composition.
    - Uses useDeliverables() with filters from nuqs state.
    - PageHeader: "Deliverables" with description "All task deliverables across agents".
    - FilterBar below header.
    - DeliverablesTable with filtered results.
    - Loading skeleton: SkeletonCard x 6 in grid.

    **Route page**: Standard async server component, Suspense wrapper.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - /deliverables renders grouped deliverable cards
    - Task titles link to /missions/[taskId]
    - Filters narrow results by task status and agent
  </verify>
  <done>
    - /deliverables shows deliverables grouped by task with clickable task title links
    - Each deliverable card shows type-appropriate preview (file/code/link)
    - Task status and agent filters work via URL-persisted dropdowns
  </done>
</task>

<task type="auto">
  <name>Task 2: File upload page with drag-and-drop and target selector at /workspace/upload</name>
  <files>
    src/features/workspace/api/use-file-upload.ts
    src/features/workspace/components/upload-dialog.tsx
    src/views/workspace/upload-view.tsx
    app/(dashboard)/workspace/upload/page.tsx
  </files>
  <action>
    **use-file-upload.ts**: TanStack Query mutation hook for file upload.
    - Accepts: { files: File[], target: UploadTarget } (UploadTarget from @/entities/workspace).
    - Mock: simulate 500ms delay, then return success with mock file metadata (name, size, path).
    - On success: invalidate queryKeys.workspace.tree() to refresh file tree.
    - On success: show sonner toast "Files uploaded successfully".
    - On error: show sonner toast with error message.

    **upload-dialog.tsx**: UploadDialog component (can be used inline or in a dialog).
    - Drag-and-drop zone:
      - Dashed border area (border-2 border-dashed rounded-lg p-8) with upload icon and "Drag files here or click to browse" text.
      - Uses HTML input[type=file] with multiple attribute, hidden, triggered by click.
      - Drag events (dragenter/dragleave/drop with drag counter ref pattern from Phase 4) to show hover state (bg-accent/10 border-primary).
      - Display dropped/selected files as a list: file name, size (formatted as KB/MB), remove button per file.
    - Target selector:
      - Radio group or Select dropdown: "Shared workspace", or per-agent options (list mock agents: Research Agent, Code Agent, Data Agent, Writer Agent).
      - Default: "Shared workspace".
    - Upload button: disabled when no files selected. Shows loading state during upload.
    - File type validation: block files > 50MB with error message. Accept all common file types.
    - Uses useFileUpload mutation on submit.

    **upload-view.tsx**: UploadView composition.
    - PageHeader: "Upload Files" with breadcrumb Workspace > Upload, description "Upload files to agent workspace".
    - UploadDialog rendered as main content (not in a modal, full page).
    - After successful upload: show success state with "View in workspace" link to /workspace.

    **Route page**: Standard async server component, Suspense wrapper.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - /workspace/upload renders drag-and-drop zone
    - Can select files via click or drag
    - Target selector shows shared and per-agent options
    - Upload button triggers mock mutation with toast feedback
  </verify>
  <done>
    - /workspace/upload shows drag-and-drop file upload zone
    - Files can be selected via click or drag-and-drop
    - Target selector allows choosing shared workspace or per-agent directory
    - Upload triggers with loading state and success toast
    - File size validation prevents uploads > 50MB
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- Both /deliverables and /workspace/upload routes resolve
- Deliverables show task-grouped layout with working filters
- Upload zone accepts drag-and-drop with target selection
</verification>

<success_criteria>
- FILE-03: /deliverables shows task-grouped deliverables with filtering by status and agent
- FILE-04: /workspace/upload provides drag-and-drop file upload with shared/per-agent target selection
</success_criteria>

<output>
After completion, create `.planning/phases/08-sessions-memory-files-governance/08-04-SUMMARY.md`
</output>
