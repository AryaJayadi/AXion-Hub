---
phase: 06-mission-board
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/features/missions/schemas/task-schemas.ts
  - src/features/missions/api/use-task-detail.ts
  - src/features/missions/api/use-task-mutations.ts
  - src/features/missions/components/task-create-dialog.tsx
  - src/features/missions/components/task-slide-over.tsx
  - src/features/missions/components/task-detail-content.tsx
  - src/views/missions/mission-detail-view.tsx
  - src/views/missions/mission-create-view.tsx
  - app/(dashboard)/missions/new/page.tsx
  - app/(dashboard)/missions/[taskId]/page.tsx
autonomous: true
requirements:
  - TASK-02
  - TASK-03

must_haves:
  truths:
    - "User can create a task via dialog or /missions/new with title, description, priority, assigned agents, reviewer, tags, subtasks, and sign-off toggle"
    - "Created task appears on the board in the INBOX column"
    - "User can click a card on the board to see a slide-over panel with task details"
    - "User can expand from slide-over to full page at /missions/[taskId]"
    - "Task detail shows all fields: title, markdown description, priority, assigned agents, reviewer, tags, subtasks checklist, due date"
  artifacts:
    - path: "src/features/missions/components/task-create-dialog.tsx"
      provides: "Task creation dialog with react-hook-form + Zod validation"
    - path: "src/features/missions/components/task-slide-over.tsx"
      provides: "Sheet-based slide-over panel for quick task peek"
    - path: "src/features/missions/components/task-detail-content.tsx"
      provides: "Shared task detail content used by both slide-over and full page"
    - path: "src/views/missions/mission-detail-view.tsx"
      provides: "Full task detail page view at /missions/[taskId]"
    - path: "app/(dashboard)/missions/new/page.tsx"
      provides: "Task creation route page"
  key_links:
    - from: "src/features/missions/components/task-create-dialog.tsx"
      to: "src/features/missions/api/use-task-mutations.ts"
      via: "useCreateTask mutation with optimistic board insert"
      pattern: "useCreateTask"
    - from: "src/features/missions/components/task-slide-over.tsx"
      to: "src/features/missions/components/task-detail-content.tsx"
      via: "Shared TaskDetailContent component rendered inside Sheet"
      pattern: "TaskDetailContent"
    - from: "src/features/missions/components/kanban-card.tsx"
      to: "src/features/missions/components/task-slide-over.tsx"
      via: "Card click opens slide-over via board view state"
      pattern: "setSelectedTask"
---

<objective>
Build the task creation dialog/form and task detail views (slide-over panel + full page). Users can create tasks with all required fields and view complete task details both inline and as dedicated pages.

Purpose: Creation and inspection are the two core CRUD operations alongside the board's drag-and-drop. This plan completes the task lifecycle user experience.
Output: Task creation dialog and /missions/new page, task slide-over panel, full detail page at /missions/[taskId], and mutation hooks with optimistic updates.
</objective>

<execution_context>
@/home/arya/.claude/get-shit-done/workflows/execute-plan.md
@/home/arya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-mission-board/06-RESEARCH.md
@.planning/phases/06-mission-board/06-CONTEXT.md
@.planning/phases/06-mission-board/06-01-SUMMARY.md
@src/entities/mission/model/types.ts
@src/entities/mission/model/schemas.ts
@src/features/missions/model/board-store.ts
@src/features/missions/model/task-store.ts
@src/features/missions/model/hooks.ts
@src/shared/ui/sheet.tsx
@src/shared/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Task creation dialog with form validation and mutation hook</name>
  <files>
    src/features/missions/schemas/task-schemas.ts
    src/features/missions/api/use-task-mutations.ts
    src/features/missions/components/task-create-dialog.tsx
    src/views/missions/mission-create-view.tsx
    app/(dashboard)/missions/new/page.tsx
  </files>
  <action>
    **1. Create task form schemas** at `src/features/missions/schemas/task-schemas.ts`:
    - Import from `zod/v4`
    - Re-export `createTaskSchema` from entity schemas and extend with form-specific fields
    - `subtaskInputSchema`: z.object({ title: z.string().min(1) })
    - `taskFormSchema`: the full form validation schema matching createTaskSchema plus subtasks array
    - Export `TaskFormValues` inferred type

    **2. Create task mutation hooks** at `src/features/missions/api/use-task-mutations.ts`:
    - `useCreateTask()`: TanStack Query mutation
      - onMutate: optimistic insert into task store (addTask with nanoid ID, status 'inbox'), add to board store's INBOX column tasksByColumn
      - onSuccess: replace optimistic task with server response (mock: just resolve with the optimistic data)
      - onError: rollback -- remove optimistic task from task store and board store
      - Show sonner toast on success ("Task created") and error ("Failed to create task")
    - `useUpdateTask()`: TanStack Query mutation
      - onMutate: snapshot current task, optimistic update via task store updateTask
      - onError: rollback to snapshot
    - `useDeleteTask()`: TanStack Query mutation
      - onMutate: remove from task store and board store
      - onError: rollback

    **3. Create TaskCreateDialog** at `src/features/missions/components/task-create-dialog.tsx`:
    - "use client" directive
    - Uses Dialog (not Sheet) from shadcn
    - react-hook-form with zodResolver(taskFormSchema as any) -- "as any" cast per project pattern for Zod v4 + exactOptionalPropertyTypes
    - Form fields:
      - Title: Input, required
      - Description: MDEditor (loaded via next/dynamic with ssr:false, following agent-identity-editor pattern)
      - Priority: Select dropdown with 4 options (critical/high/medium/low), default medium
      - Assigned Agents: Multi-select using command/popover pattern. Render list of agents from agent store for selection. Show selected as removable Badge chips.
      - Reviewer: Single select from agent store or manual input
      - Tags: Freeform tag input -- type text, press Enter to add as Badge chip, click X to remove
      - Subtasks: Dynamic list -- Add Subtask button adds input row, remove button per row
      - Due Date: Date picker using Popover + Calendar (install calendar shadcn component if not present)
      - Sign-off Required: Switch toggle with label "Require human sign-off before DONE"
      - Board ID: hidden field, set to active board ID from board store
    - Submit calls useCreateTask mutation
    - On success: close dialog, reset form
    - Cancel button closes without saving

    **4. Create MissionCreateView** at `src/views/missions/mission-create-view.tsx`:
    - "use client" directive
    - Full-page version of the task creation form (same fields as dialog, but rendered in page layout)
    - Uses PageHeader with title "New Task" and back link to /missions
    - Uses react-hook-form with same schema
    - On success: redirect to /missions via router.push

    **5. Create route page** at `app/(dashboard)/missions/new/page.tsx`:
    - Server component wrapping MissionCreateView in Suspense
    - Metadata: title "New Task | AXion Hub"

    **6. Wire "New Task" button** in MissionsBoardView:
    - Update the existing PageHeader in missions-board-view.tsx to have a "New Task" button that opens TaskCreateDialog
    - Also add a "+" button/link to /missions/new for full-page creation
    - Manage dialog open state in the view
  </action>
  <verify>
    Run `bun run build` -- must pass. Verify /missions/new route is registered. Verify the New Task button on /missions opens the creation dialog. Submit a task and verify it appears in the INBOX column.
  </verify>
  <done>
    Task creation dialog renders all fields (title, markdown description, priority, agents, reviewer, tags, subtasks, due date, sign-off toggle). Form validation via Zod v4. Optimistic mutation adds task to INBOX column immediately. Full-page creation at /missions/new also works. New Task button wired in board view header. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Task detail slide-over panel and full detail page</name>
  <files>
    src/features/missions/api/use-task-detail.ts
    src/features/missions/components/task-detail-content.tsx
    src/features/missions/components/task-slide-over.tsx
    src/views/missions/mission-detail-view.tsx
    app/(dashboard)/missions/[taskId]/page.tsx
  </files>
  <action>
    **1. Create task detail query hook** at `src/features/missions/api/use-task-detail.ts`:
    - `useTaskDetail(taskId: string)`: TanStack Query hook, fetches single task
    - staleTime: Infinity (project pattern)
    - refetchOnWindowFocus: false
    - Mock: return task from task store's Map by ID
    - Syncs task detail into task store selectedTaskId

    **2. Create TaskDetailContent** at `src/features/missions/components/task-detail-content.tsx`:
    - "use client" directive
    - Shared content component used by BOTH slide-over and full page
    - Props: taskId (string), isCompact (boolean, for slide-over vs full-page layout adjustments)
    - Renders task data from useTask(taskId) hook:
      - Title as h2 (editable inline on full page -- ContentEditable-like with blur-to-save)
      - Priority badge with color-coded indicator
      - Status badge showing current column
      - Assigned agents section: AvatarGroup with agent names below
      - Reviewer section: single avatar + name
      - Due date display with relative time (date-fns formatDistanceToNow)
      - Markdown description rendered via MDEditor in preview mode (or a simple markdown renderer)
      - Tags as Badge components in a flex-wrap row
      - Subtasks as checklist: each subtask has a Checkbox + title, click toggles completed state (optimistic via task store)
      - Placeholder sections for: Activity Timeline (plan 06-03), Deliverables (plan 06-03), Comments (plan 06-04) -- render Section headers with "Coming soon" EmptyState
    - When isCompact=true: single-column layout, smaller text
    - When isCompact=false: two-column layout (main content left, metadata sidebar right)

    **3. Create TaskSlideOver** at `src/features/missions/components/task-slide-over.tsx`:
    - "use client" directive
    - Uses Sheet component from shadcn (side="right", className="w-full sm:max-w-xl")
    - Props: taskId (string | null), open (boolean), onClose (() => void)
    - Sheet header: task title (SheetTitle) + priority badge
    - Sheet content: TaskDetailContent with isCompact=true
    - Sheet footer:
      - "Open full page" button as Link to /missions/[taskId] with Expand icon
      - "Edit" button (placeholder, uses task update mutation)
      - "Delete" button with AlertDialog confirmation (uses useDeleteTask mutation)

    **4. Wire slide-over into KanbanBoard/MissionsBoardView:**
    - When user clicks a KanbanCard (not drag), call taskStore.setSelectedTask(taskId) and open slide-over
    - Distinguish click from drag: useSortable provides isDragging -- only open slide-over on click if not isDragging. Use the onClick handler on the card wrapper and check against a "was dragging" flag (set on dragStart, cleared on timeout after dragEnd).
    - In MissionsBoardView: render TaskSlideOver, controlled by selectedTaskId from task store

    **5. Create MissionDetailView** at `src/views/missions/mission-detail-view.tsx`:
    - "use client" directive
    - Full-page task detail view
    - Uses PageHeader with breadcrumb: Missions > [Task Title]
    - Renders TaskDetailContent with isCompact=false
    - Back link to /missions
    - Action buttons: Edit (inline), Delete (with confirmation), Change Status dropdown

    **6. Create route page** at `app/(dashboard)/missions/[taskId]/page.tsx`:
    - Server component
    - Extract taskId from params
    - Render MissionDetailView with taskId prop
    - Metadata: title "Task Detail | AXion Hub"
  </action>
  <verify>
    Run `bun run build` -- must pass. Verify /missions/[taskId] route is registered. Click a card on the board to verify slide-over opens. Click "Open full page" to verify navigation to /missions/[taskId]. Verify all task fields render correctly in both views.
  </verify>
  <done>
    Clicking a Kanban card opens a right-side slide-over with task details. Slide-over shows title, priority, status, agents, description, tags, subtasks, and expand button. Full page at /missions/[taskId] shows two-column layout with all fields. Delete works with confirmation dialog. Placeholder sections ready for 06-03 (timeline, deliverables) and 06-04 (comments). Build passes.
  </done>
</task>

</tasks>

<verification>
1. `bun run build` passes with zero TypeScript errors
2. /missions/new route renders task creation form with all fields
3. "New Task" button on /missions opens creation dialog
4. Created task appears in INBOX column with optimistic update
5. Clicking a card opens slide-over panel with task details
6. Slide-over has "Open full page" link navigating to /missions/[taskId]
7. Full task detail page renders two-column layout with all fields
8. Subtask checkboxes toggle optimistically
9. Delete task works with confirmation dialog
</verification>

<success_criteria>
- Task creation dialog with all required fields (title, description, priority, agents, reviewer, tags, subtasks, due date, sign-off toggle)
- Optimistic task creation adds card to INBOX column immediately
- Slide-over panel opens on card click with task details
- Full detail page at /missions/[taskId] with two-column layout
- Both views share TaskDetailContent component
- Placeholder sections for timeline, deliverables, and comments ready for subsequent plans
</success_criteria>

<output>
After completion, create `.planning/phases/06-mission-board/06-02-SUMMARY.md`
</output>
